<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" href="/favicon.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
    <title>Frappe ERP</title>
    
    <!-- Primary Meta Tags -->
    <meta name="title" content="Frappe ERP" />
    <meta name="description" content="Custom ERP Application" />
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#ffffff" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="application-name" content="Frappe ERP" />
    
    <!-- Android Chrome PWA Meta Tags -->
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    
    <!-- Apple iOS Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="Frappe ERP" />
    <link rel="apple-touch-icon" href="/apple-touch-icon.png" />
    
    <!-- Apple Splash Screens -->
    <link rel="apple-touch-startup-image" href="/icons/icon-512x512.png" />
    
    <!-- Dynamic manifest loader - sets manifest based on current route -->
    <!-- CRITICAL: This must run synchronously before page load for Android Chrome -->
    <script>
    (function () {
      // Detect app from pathname immediately
      const segs = location.pathname.split('/').filter(Boolean);
      let app = 'home';
      
      // Handle /jsapp/{app}/ paths
      if (segs.length >= 2 && segs[0] === 'jsapp') {
        app = segs[1] || 'home';
      } else if (segs.length >= 1 && segs[0] !== '') {
        app = segs[0];
      }
      
      // Normalize app name
      if (!app || app === 'jsapp' || app === '') {
        app = 'home';
      }
      
      const manifestMap = {
        '': '/manifest-home.json',
        'home': '/manifest-home.json',
        'qrpay': '/manifest-qrpay.json',
        'qrpay-admin': '/manifest-qrpay-admin.json',
        'scanner': '/manifest-scanner.json',
        'pay-dashboard': '/manifest-pay-dashboard.json',
        'uploadsales': '/manifest-uploadsales.json'
      };
      
      const manifestPath = manifestMap[app] || '/manifest-home.json';
      
      // Create manifest link synchronously (critical for Android Chrome)
      const link = document.createElement('link');
      link.rel = 'manifest';
      link.href = manifestPath;
      
      // Insert before any other scripts to ensure early loading
      const firstScript = document.getElementsByTagName('script')[0];
      if (firstScript && firstScript.parentNode) {
        firstScript.parentNode.insertBefore(link, firstScript);
      } else {
        document.head.appendChild(link);
      }
      
      // Log for debugging
      console.log('ðŸ“± PWA Manifest set:', manifestPath, 'for app:', app);
    })();
    </script>
    
    <!-- Microsoft Windows Meta Tags -->
    <meta name="msapplication-TileColor" content="#ffffff" />
    <meta name="msapplication-TileImage" content="/icons/icon-144x144.png" />
    <meta name="msapplication-tap-highlight" content="no" />
  </head>
  <body>
    <div id="app"></div>
    <script type="module" src="/src/main.js"></script>
  </body>
</html>
