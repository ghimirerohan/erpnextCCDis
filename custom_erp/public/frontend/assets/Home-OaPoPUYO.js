var V=(A,h,l)=>new Promise((_,f)=>{var v=u=>{try{w(l.next(u))}catch(k){f(k)}},i=u=>{try{w(l.throw(u))}catch(k){f(k)}},w=u=>u.done?_(u.value):Promise.resolve(u.value).then(v,i);w((l=l.apply(A,h)).next())});import{_ as ot,r as y,a as rt,c as U,w as nt,o as it,b as n,d as t,t as a,u as P,e as B,f as S,n as O,g as b,h as E,i as M,v as Q,F as C,j as D,k as dt,l as q,m as r,s as H,p as T}from"./index-CcQ_ikCj.js";const lt={class:"min-h-screen bg-gray-50"},ct={class:"bg-white shadow-sm border-b border-gray-200"},ut={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},mt={class:"flex justify-between items-center py-6"},xt={class:"text-sm text-gray-600"},pt={class:"flex gap-2"},gt={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},yt={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-8"},_t={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},ht={class:"relative"},ft={class:"relative"},vt={key:0,class:"border border-gray-300 rounded-md p-3"},bt={class:"text-sm font-medium text-gray-900"},wt={class:"text-xs text-gray-600 mt-1"},kt={key:1},St={class:"flex space-x-2 mb-3"},Ct={key:0,class:"p-3 border border-gray-200 rounded-md text-sm text-gray-700"},Dt={key:0},Tt={key:1},It={key:1,class:"p-3 border border-gray-200 rounded-md"},Nt={key:0,class:"mt-2 text-sm text-gray-600"},$t={class:"mt-4 flex justify-end"},Vt={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-6"},Ft={class:"flex items-center justify-between"},Rt={class:"flex bg-gray-100 rounded-lg p-1"},Bt={key:0,class:"flex justify-center items-center py-12"},Ot={key:2,class:"space-y-6"},Pt={class:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden"},qt={class:"px-6 py-4 border-b border-gray-200"},At={class:"text-lg font-semibold text-gray-900"},jt={class:"overflow-x-auto"},Lt={class:"min-w-full divide-y divide-gray-200"},Ut={class:"bg-white divide-y divide-gray-200"},Et={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-blue-600"},Mt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Qt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Ht={class:"px-6 py-4 whitespace-nowrap"},Jt={class:"px-6 py-4 whitespace-nowrap text-sm text-right text-gray-900 font-medium"},zt={class:"px-6 py-4 whitespace-nowrap text-sm text-right text-gray-900"},Wt={class:"px-6 py-4 border-b border-gray-200"},Gt={class:"text-md font-semibold text-gray-900"},Kt={class:"text-sm text-gray-600"},Xt={class:"overflow-x-auto"},Yt={class:"min-w-full divide-y divide-gray-200"},Zt={class:"bg-white divide-y divide-gray-200"},te={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},ee={class:"px-6 py-4 text-sm text-gray-900"},se={class:"px-6 py-4 whitespace-nowrap text-sm text-right text-gray-900"},ae={class:"px-6 py-4 whitespace-nowrap text-sm text-right text-gray-900"},oe={class:"px-6 py-4 whitespace-nowrap text-sm text-right text-gray-900 font-medium"},re={key:3,class:"space-y-6"},ne={class:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden"},ie={class:"px-6 py-4 border-b border-gray-200"},de={class:"text-lg font-semibold text-gray-900"},le={class:"overflow-x-auto"},ce={class:"min-w-full divide-y divide-gray-200"},ue={class:"bg-white divide-y divide-gray-200"},me={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},xe={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},pe={class:"px-6 py-4 whitespace-nowrap text-sm text-center text-gray-900"},ge={class:"px-6 py-4 whitespace-nowrap text-sm text-right text-gray-900 font-medium"},ye={class:"px-6 py-4 whitespace-nowrap text-sm text-right text-gray-900"},_e={class:"px-6 py-4 whitespace-nowrap text-sm text-right text-gray-900"},he={class:"px-6 py-4 border-b border-gray-200"},fe={class:"text-md font-semibold text-gray-900"},ve={class:"text-sm text-gray-600"},be={class:"overflow-x-auto"},we={class:"min-w-full divide-y divide-gray-200"},ke={class:"bg-white divide-y divide-gray-200"},Se={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},Ce={class:"px-6 py-4 text-sm text-gray-900"},De={class:"px-6 py-4 whitespace-nowrap text-sm text-right text-gray-900"},Te={class:"px-6 py-4 whitespace-nowrap text-sm text-right text-gray-900"},Ie={class:"px-6 py-4 whitespace-nowrap text-sm text-right text-gray-900 font-medium"},Ne={key:4,class:"text-center py-12"},$e={__name:"Home",setup(A){const h=y(!1),l=y(""),_=y("bill"),f=y([]),v=y([]),i=rt({customer:"",from_date:"",to_date:""}),w=y(!1),u=y("photo"),k=y(!1),I=y(""),N=y({customer:"",customer_name:"",customer_code:"",invoice_no:""}),J=typeof window!="undefined"&&"BarcodeDetector"in window,z=y(null),W=U({url:"custom_erp.custom_erp.sales_invoice.api.get_sales_invoices",auto:!1,onSuccess:o=>{o.success?(f.value=o.data,l.value=""):l.value=o.error||"Failed to load sales invoices"},onError:o=>{l.value="Failed to load sales invoices: "+o.message}}),G=U({url:"custom_erp.custom_erp.sales_invoice.api.get_sales_invoice_summary",auto:!1,onSuccess:o=>{o.success?(v.value=o.data,l.value=""):l.value=o.error||"Failed to load summary data"},onError:o=>{l.value="Failed to load summary data: "+o.message}}),j=()=>V(this,null,function*(){if(!i.customer||!i.from_date||!i.to_date){l.value="Please fill in all required fields";return}h.value=!0,l.value="";try{const o=JSON.stringify(i);_.value==="bill"?yield W.fetch({filters:o}):yield G.fetch({filters:o})}catch(o){l.value="Failed to load data: "+o.message}finally{h.value=!1}}),F=o=>o?new Date(o).toLocaleDateString():"",x=o=>o==null?"0.00":new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(o),K=o=>({Paid:"green",Unpaid:"red",Overdue:"orange",Draft:"gray",Submitted:"blue"})[o]||"gray",X=()=>{w.value=!1,i.customer="",N.value={customer:"",customer_name:"",customer_code:"",invoice_no:""},I.value=""},Y=o=>V(this,null,function*(){var p,m;const e=(m=(p=o==null?void 0:o.target)==null?void 0:p.files)==null?void 0:m[0];if(e){I.value="",k.value=!0;try{const c=yield new Promise((st,at)=>{const R=new FileReader;R.onload=()=>st(String(R.result)),R.onerror=at,R.readAsDataURL(e)}),s=yield fetch("/api/method/custom_erp.custom_erp.purchase_invoice.api.extract_invoice",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({image_data:c})}),d=yield s.json(),g=(d==null?void 0:d.message)||d;if(!s.ok||!(g!=null&&g.success)||!(g!=null&&g.data))throw new Error((g==null?void 0:g.error)||`Extraction failed (${s.status})`);const L=g.data.invoiceNumber||"",et=g.data.customerName||"",$=yield Z({invoiceBillNumber:L,customerCode:""});if(!$)throw new Error("Could not find matching customer from code or invoice");i.customer=$.customer,N.value={customer:$.customer,customer_name:$.customer_name||et||$.customer,customer_code:"",invoice_no:L||""},w.value=!0}catch(c){I.value=c.message||"Failed to process image"}finally{k.value=!1}}});function Z(p){return V(this,arguments,function*({invoiceBillNumber:o,customerCode:e}){if(e){const m=["mobile_no","customer_code"];for(const c of m)try{const s=yield tt(c,e);if(s)return s}catch(s){}}if(o)try{const m=yield fetch(`/api/resource/Sales%20Invoice/${encodeURIComponent(o)}`);if(m.ok){const c=yield m.json(),s=c==null?void 0:c.data;if(s!=null&&s.customer)return{customer:s.customer,customer_name:s.customer_name||s.customer}}}catch(m){}return null})}function tt(o,e){return V(this,null,function*(){const p=new URLSearchParams;p.set("fields",JSON.stringify(["name","customer_name"])),p.set("filters",JSON.stringify([[o,"=",String(e)]])),p.set("limit_page_length","1");const m=yield fetch(`/api/resource/Customer?${p.toString()}`);if(!m.ok)return null;const c=yield m.json(),s=c==null?void 0:c.data;return Array.isArray(s)&&s.length>0?{customer:s[0].name,customer_name:s[0].customer_name||s[0].name}:null})}return nt(_,()=>{i.customer&&i.from_date&&i.to_date&&j()}),it(()=>{const o=new Date,e=new Date(o.getTime()-30*24*60*60*1e3);i.to_date=o.toISOString().split("T")[0],i.from_date=e.toISOString().split("T")[0]}),(o,e)=>{const p=q("Button"),m=q("Alert"),c=q("Badge");return r(),n("div",lt,[t("div",ct,[t("div",ut,[t("div",mt,[t("div",null,[e[8]||(e[8]=t("h1",{class:"text-2xl font-bold text-gray-900"},"Sales Invoice Dashboard",-1)),t("p",xt,"Welcome "+a(P(H).user)+"!",1)]),t("div",pt,[B(p,{onClick:e[0]||(e[0]=s=>o.$router.push({name:"Scanner"})),theme:"blue",variant:"solid"},{default:S(()=>e[9]||(e[9]=[T(" Open Scanner ")])),_:1,__:[9]}),B(p,{onClick:e[1]||(e[1]=s=>P(H).logout.submit()),theme:"gray",variant:"outline"},{default:S(()=>e[10]||(e[10]=[T(" Logout ")])),_:1,__:[10]})])])])]),t("div",gt,[t("div",yt,[e[18]||(e[18]=t("h2",{class:"text-lg font-semibold text-gray-900 mb-4"},"Filters",-1)),t("div",_t,[t("div",ht,[e[14]||(e[14]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Customer",-1)),t("div",ft,[w.value?(r(),n("div",vt,[t("div",bt,a(N.value.customer_name),1),t("div",wt,[t("span",null,"Code: "+a(N.value.customer_code||"—"),1),e[11]||(e[11]=t("span",{class:"mx-2"},"|",-1)),t("span",null,"Invoice: "+a(N.value.invoice_no||"—"),1)]),t("div",{class:"mt-2"},[t("button",{onClick:X,class:"text-sm text-blue-600 underline"},"Change selection")])])):(r(),n("div",kt,[t("div",St,[t("button",{onClick:e[2]||(e[2]=s=>u.value="qr"),class:O(["px-3 py-2 text-sm font-medium rounded-md border transition-colors",u.value==="qr"?"bg-blue-50 border-blue-400 text-blue-700":"bg-white border-gray-300 text-gray-700 hover:bg-gray-50"])}," QR Scanner ",2),t("button",{onClick:e[3]||(e[3]=s=>u.value="photo"),class:O(["px-3 py-2 text-sm font-medium rounded-md border transition-colors",u.value==="photo"?"bg-blue-50 border-blue-400 text-blue-700":"bg-white border-gray-300 text-gray-700 hover:bg-gray-50"])}," Photo / Camera ",2)]),u.value==="qr"?(r(),n("div",Ct,[P(J)?(r(),n("div",Dt,[e[12]||(e[12]=t("div",{class:"mb-2"},"Point your camera at the QR code.",-1)),t("video",{ref_key:"qrVideo",ref:z,class:"w-full rounded",autoplay:"",playsinline:"",muted:""},null,512),e[13]||(e[13]=t("div",{class:"mt-2 text-xs text-gray-500"},"Scanning...",-1))])):(r(),n("div",Tt," QR scanning is not supported on this device/browser. Please use Photo. "))])):u.value==="photo"?(r(),n("div",It,[t("input",{type:"file",accept:"image/*",capture:"environment",onChange:Y},null,32),k.value?(r(),n("div",Nt,"Processing image...")):b("",!0),I.value?(r(),E(m,{key:1,theme:"red",class:"mt-2"},{default:S(()=>[T(a(I.value),1)]),_:1})):b("",!0)])):b("",!0)]))])]),t("div",null,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"From Date",-1)),M(t("input",{type:"date","onUpdate:modelValue":e[4]||(e[4]=s=>i.from_date=s),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:""},null,512),[[Q,i.from_date]])]),t("div",null,[e[16]||(e[16]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"To Date",-1)),M(t("input",{type:"date","onUpdate:modelValue":e[5]||(e[5]=s=>i.to_date=s),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:""},null,512),[[Q,i.to_date]])])]),t("div",$t,[B(p,{onClick:j,loading:h.value,theme:"blue",variant:"solid",disabled:!i.customer||!i.from_date||!i.to_date},{default:S(()=>e[17]||(e[17]=[T(" Load Data ")])),_:1,__:[17]},8,["loading","disabled"])])]),t("div",Vt,[t("div",Ft,[e[19]||(e[19]=t("h2",{class:"text-lg font-semibold text-gray-900"},"View Options",-1)),t("div",Rt,[t("button",{onClick:e[6]||(e[6]=s=>_.value="bill"),class:O(["px-4 py-2 text-sm font-medium rounded-md transition-colors",_.value==="bill"?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-900"])}," Bill-wise View ",2),t("button",{onClick:e[7]||(e[7]=s=>_.value="summary"),class:O(["px-4 py-2 text-sm font-medium rounded-md transition-colors",_.value==="summary"?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-900"])}," Summary View ",2)])])]),h.value?(r(),n("div",Bt,e[20]||(e[20]=[t("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1),t("span",{class:"ml-3 text-gray-600"},"Loading data...",-1)]))):b("",!0),l.value?(r(),E(m,{key:1,theme:"red",class:"mb-6"},{default:S(()=>[T(a(l.value),1)]),_:1})):b("",!0),_.value==="bill"&&!h.value&&f.value.length>0?(r(),n("div",Ot,[t("div",Pt,[t("div",qt,[t("h3",At," Sales Invoices ("+a(f.value.length)+" invoices) ",1)]),t("div",jt,[t("table",Lt,[e[21]||(e[21]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Invoice "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Date "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Customer "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Status "),t("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"}," Total Amount "),t("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"}," Outstanding ")])],-1)),t("tbody",Ut,[(r(!0),n(C,null,D(f.value,s=>(r(),n("tr",{key:s.name,class:"hover:bg-gray-50"},[t("td",Et,a(s.name),1),t("td",Mt,a(F(s.posting_date)),1),t("td",Qt,a(s.customer_name),1),t("td",Ht,[B(c,{theme:K(s.status)},{default:S(()=>[T(a(s.status),1)]),_:2},1032,["theme"])]),t("td",Jt,a(x(s.grand_total)),1),t("td",zt,a(x(s.outstanding_amount)),1)]))),128))])])])]),(r(!0),n(C,null,D(f.value,s=>(r(),n("div",{key:`details-${s.name}`,class:"bg-white rounded-lg shadow-sm border border-gray-200"},[t("div",Wt,[t("h4",Gt," Invoice: "+a(s.name)+" - "+a(s.customer_name),1),t("p",Kt," Date: "+a(F(s.posting_date))+" | Total: "+a(x(s.grand_total)),1)]),t("div",Xt,[t("table",Yt,[e[22]||(e[22]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Item "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Description "),t("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"}," Qty "),t("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"}," Rate "),t("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"}," Amount ")])],-1)),t("tbody",Zt,[(r(!0),n(C,null,D(s.items,d=>(r(),n("tr",{key:d.item_code,class:"hover:bg-gray-50"},[t("td",te,a(d.item_code),1),t("td",ee,a(d.item_name),1),t("td",se,a(d.qty)+" "+a(d.uom),1),t("td",ae,a(x(d.rate)),1),t("td",oe,a(x(d.amount)),1)]))),128))])])])]))),128))])):b("",!0),_.value==="summary"&&!h.value&&v.value.length>0?(r(),n("div",re,[t("div",ne,[t("div",ie,[t("h3",de," Summary by Customer & Date ("+a(v.value.length)+" groups) ",1)]),t("div",le,[t("table",ce,[e[23]||(e[23]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Customer "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Date "),t("th",{class:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider"}," Invoices "),t("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"}," Total Amount "),t("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"}," Net Total "),t("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"}," Outstanding ")])],-1)),t("tbody",ue,[(r(!0),n(C,null,D(v.value,s=>(r(),n("tr",{key:`${s.customer}-${s.posting_date}`,class:"hover:bg-gray-50"},[t("td",me,a(s.customer_name),1),t("td",xe,a(F(s.posting_date)),1),t("td",pe,a(s.invoice_count),1),t("td",ge,a(x(s.total_amount)),1),t("td",ye,a(x(s.net_total)),1),t("td",_e,a(x(s.outstanding_amount)),1)]))),128))])])])]),(r(!0),n(C,null,D(v.value,s=>(r(),n("div",{key:`summary-${s.customer}-${s.posting_date}`,class:"bg-white rounded-lg shadow-sm border border-gray-200"},[t("div",he,[t("h4",fe,a(s.customer_name)+" - "+a(F(s.posting_date)),1),t("p",ve,a(s.invoice_count)+" invoices | Total: "+a(x(s.total_amount)),1)]),t("div",be,[t("table",we,[e[24]||(e[24]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Item "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Description "),t("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"}," Total Qty "),t("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"}," Avg Rate "),t("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"}," Total Amount ")])],-1)),t("tbody",ke,[(r(!0),n(C,null,D(s.items,d=>(r(),n("tr",{key:d.item_code,class:"hover:bg-gray-50"},[t("td",Se,a(d.item_code),1),t("td",Ce,a(d.item_name),1),t("td",De,a(d.total_qty)+" "+a(d.uom),1),t("td",Te,a(x(d.avg_rate)),1),t("td",Ie,a(x(d.total_amount)),1)]))),128))])])])]))),128))])):b("",!0),!h.value&&f.value.length===0&&v.value.length===0?(r(),n("div",Ne,e[25]||(e[25]=[dt('<div class="text-gray-400 mb-4" data-v-4770fa87><svg class="mx-auto h-12 w-12" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-v-4770fa87><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" data-v-4770fa87></path></svg></div><h3 class="text-lg font-medium text-gray-900 mb-2" data-v-4770fa87>No data found</h3><p class="text-gray-600" data-v-4770fa87>Try adjusting your filters or selecting a different date range.</p>',3)]))):b("",!0)])])}}},Re=ot($e,[["__scopeId","data-v-4770fa87"]]);export{Re as default};
//# sourceMappingURL=Home-OaPoPUYO.js.map
