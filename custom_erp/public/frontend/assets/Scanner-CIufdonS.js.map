{"version":3,"file":"Scanner-CIufdonS.js","sources":["../../../../frontend/src/pages/Scanner.vue"],"sourcesContent":["<template>\n  <div class=\"min-h-screen bg-gray-50\">\n    <div class=\"bg-white shadow-sm border-b border-gray-200 sticky top-0 z-20\">\n      <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n        <div class=\"flex justify-between items-center py-6\">\n          <div>\n            <h1 class=\"text-2xl font-bold text-gray-900\">Invoice Scanner</h1>\n            <p class=\"text-sm text-gray-600\">Authenticated as {{ session.user }}</p>\n          </div>\n          <Button @click=\"session.logout.submit()\" theme=\"gray\" variant=\"outline\">Logout</Button>\n        </div>\n      </div>\n    </div>\n\n    <div class=\"max-w-7xl mx-auto px-3 sm:px-4 lg:px-6 py-4 sm:py-8\">\n      <div class=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-8\">\n        <h2 class=\"text-lg font-semibold text-gray-900 mb-4\">Invoice Image Input</h2>\n        \n        <!-- Invoice Type Selection -->\n        <div class=\"mb-4\">\n          <label class=\"block text-sm text-gray-700 mb-2\">Invoice Type</label>\n          <div class=\"flex gap-4\">\n            <label class=\"flex items-center gap-2\">\n              <input type=\"radio\" value=\"purchase\" v-model=\"finalize.type\" /> Purchase\n            </label>\n            <label class=\"flex items-center gap-2\">\n              <input type=\"radio\" value=\"sales\" v-model=\"finalize.type\" /> Sales\n            </label>\n          </div>\n        </div>\n        \n        <!-- Scanner Configuration -->\n        <div class=\"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4\">\n          <div>\n            <label class=\"block text-sm font-medium text-gray-700 mb-2\">Connection URL</label>\n            <input type=\"text\" \n                   v-model=\"scannerConfig.connectionUrl\" \n                   class=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                   placeholder=\"http://localhost:17890\" />\n          </div>\n          <div>\n            <label class=\"block text-sm font-medium text-gray-700 mb-2\">DPI</label>\n            <input type=\"number\" \n                   v-model.number=\"scannerConfig.dpi\" \n                   min=\"100\" max=\"600\" step=\"50\"\n                   class=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                   placeholder=\"300\" />\n          </div>\n        </div>\n        \n        <!-- Main Image Input Area -->\n        <div class=\"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-blue-400 transition-colors\"\n             @drop=\"onDrop\"\n             @dragover.prevent\n             @dragenter=\"() => isDragOver = true\"\n             @dragleave=\"onDragLeave\"\n             :class=\"{'border-blue-400 bg-blue-50': isDragOver}\">\n          \n          <!-- Image Preview -->\n          <div v-if=\"selectedFile || capturedDataUrl || scannedImageBlob || scannedImageUrl\" class=\"mb-4\">\n            <img v-if=\"imagePreviewUrl\" \n                 :src=\"imagePreviewUrl\" \n                 alt=\"Invoice Preview\" \n                 class=\"max-w-full h-auto max-h-64 mx-auto rounded-lg shadow-md\" />\n            <div class=\"mt-2 flex justify-center space-x-2\">\n              <button @click=\"clearImage\" \n                      class=\"px-3 py-1 text-sm text-red-600 hover:text-red-800 hover:bg-red-50 rounded\">\n                Remove Image\n              </button>\n            </div>\n          </div>\n          \n          <!-- Upload Options -->\n          <div v-if=\"!selectedFile && !capturedDataUrl && !scannedImageBlob && !scannedImageUrl\" class=\"space-y-4\">\n            <div class=\"flex flex-col sm:flex-row gap-3 justify-center\">\n              <!-- File Upload -->\n              <label class=\"flex-1 cursor-pointer\">\n                <input type=\"file\" \n                       @change=\"onFileSelected\" \n                       accept=\"image/*\" \n                       class=\"hidden\" />\n                <div class=\"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors text-center\">\n                  üìÅ Upload from Local Storage\n                </div>\n              </label>\n              \n              <!-- Scanner -->\n              <button @click=\"scan\" \n                      :disabled=\"scanning\"\n                      class=\"flex-1 px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors\">\n                <span v-if=\"scanning\">üîÑ Scanning...</span>\n                <span v-else>üì∑ Scan Document</span>\n              </button>\n            </div>\n            \n            <!-- Drag & Drop Instructions -->\n            <div class=\"text-gray-500 text-sm\">\n              <p>Or drag and drop an image file here</p>\n              <p class=\"text-xs mt-1\">Supports: JPG, PNG, WebP</p>\n            </div>\n          </div>\n        </div>\n\n        <div class=\"mt-6 flex gap-3\">\n          <Button theme=\"blue\" :loading=\"extracting\" @click=\"extractInvoice\" :disabled=\"!canExtract\">Extract Invoice</Button>\n          <Button theme=\"gray\" variant=\"outline\" @click=\"showLastInvoices\" :loading=\"loadingLastInvoices\">\n            View Last 3 {{ finalize.type === 'purchase' ? 'Purchase' : 'Sales' }} Invoices\n          </Button>\n          <Alert v-if=\"extractError\" theme=\"red\">{{ extractError }}</Alert>\n        </div>\n      </div>\n\n      <div v-if=\"invoice\" class=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-8\">\n        <h2 class=\"text-lg font-semibold text-gray-900 mb-4\">Extracted Data</h2>\n        \n        <!-- Invoice Type Indication -->\n        <div v-if=\"invoiceType\" class=\"mb-4 p-3 rounded-md\" \n             :class=\"invoiceType === 'credit_note' ? 'bg-orange-50 border border-orange-200' : 'bg-blue-50 border border-blue-200'\">\n          <div class=\"flex items-center\">\n            <div v-if=\"invoiceType === 'credit_note'\" class=\"flex-shrink-0 w-5 h-5 text-orange-400\">\n              ‚Ü∂\n            </div>\n            <div v-else class=\"flex-shrink-0 w-5 h-5 text-blue-400\">\n              üìÑ\n            </div>\n            <div class=\"ml-3\">\n              <p class=\"text-sm font-medium\" \n                 :class=\"invoiceType === 'credit_note' ? 'text-orange-800' : 'text-blue-800'\">\n                {{ invoiceType === 'credit_note' ? 'Credit Note (Return)' : 'Tax Invoice (Regular)' }}\n              </p>\n              <p class=\"text-sm\" \n                 :class=\"invoiceType === 'credit_note' ? 'text-orange-700' : 'text-blue-700'\">\n                {{ invoiceType === 'credit_note' ? 'This is a return/credit note. Will be processed as a return transaction.' : 'This is a regular tax invoice.' }}\n              </p>\n              <p class=\"text-xs mt-1 text-gray-600\">\n                {{ detectionMethod === 'title' ? `Detected from document title: \"${title}\"` : 'Inferred from document content' }}\n              </p>\n            </div>\n          </div>\n        </div>\n        \n        <div class=\"grid grid-cols-1 md:grid-cols-3 gap-3 sm:gap-4\">\n          <div>\n            <label class=\"block text-sm text-gray-600 mb-1\">Invoice Number</label>\n            <input v-model=\"invoice.invoiceNumber\" class=\"w-full px-3 py-2 border rounded\" placeholder=\"INV-001\" />\n          </div>\n          <div>\n            <label class=\"block text-sm text-gray-600 mb-1\">Invoice Date</label>\n            <input v-model=\"invoice.invoiceDate\" type=\"date\" class=\"w-full px-3 py-2 border rounded\" />\n          </div>\n          <div>\n            <label class=\"block text-sm text-gray-600 mb-1\">Supplier</label>\n            <input v-model=\"finalize.supplierName\" class=\"w-full px-3 py-2 border rounded\" placeholder=\"bntl\" />\n          </div>\n        </div>\n\n        <!-- Invoice Type moved above to enforce selection before extraction -->\n\n        <div class=\"mt-4 grid md:grid-cols-3 gap-3 sm:gap-4\">\n          <div>\n            <label class=\"block text-sm text-gray-700 mb-2\">Bill Actual Amount</label>\n            <input type=\"number\" step=\"0.01\" class=\"w-full px-3 py-2 border rounded\" v-model.number=\"finalize.billAmount\" />\n          </div>\n          <div>\n            <label class=\"block text-sm text-gray-700 mb-2\">Purchase Invoice Type</label>\n            <div class=\"flex items-center mt-2\">\n              <input type=\"checkbox\" \n                     v-model=\"finalize.isReturn\" \n                     class=\"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 focus:ring-2\" />\n              <label class=\"ml-2 text-sm text-gray-700\">Mark as Credit Note (Return)</label>\n            </div>\n            <p class=\"text-xs text-gray-500 mt-1\">\n              When checked, will be processed as a return transaction. \n              {{ detectionMethod === 'title' ? 'Auto-detected from document title.' : 'Auto-detected from document content. Please verify.' }}\n            </p>\n            <p v-if=\"detectionMethod === 'inferred'\" class=\"text-xs text-orange-600 mt-1\">\n              ‚ö†Ô∏è Detection was inferred. Please verify the invoice type is correct.\n            </p>\n          </div>\n          <div class=\"md:col-span-2\">\n            <label class=\"block text-sm text-gray-700 mb-2\">Attach Final Photo</label>\n            <div class=\"border-2 border-dashed border-gray-300 rounded-lg p-4 text-center hover:border-blue-400 transition-colors\"\n                 @drop=\"onFinalPhotoDrop\"\n                 @dragover.prevent\n                 @dragenter=\"() => isFinalPhotoDragOver = true\"\n                 @dragleave=\"onFinalPhotoDragLeave\"\n                 :class=\"{'border-blue-400 bg-blue-50': isFinalPhotoDragOver}\">\n              \n              <!-- Final Photo Preview -->\n              <div v-if=\"finalize.finalPhotoFile\" class=\"mb-4\">\n                <img v-if=\"finalPhotoPreviewUrl\" \n                     :src=\"finalPhotoPreviewUrl\" \n                     alt=\"Final Photo Preview\" \n                     class=\"max-w-full h-auto max-h-32 mx-auto rounded-lg shadow-md\" />\n                <div class=\"mt-2 flex justify-center space-x-2\">\n                  <button @click=\"clearFinalPhoto\" \n                          class=\"px-3 py-1 text-sm text-red-600 hover:text-red-800 hover:bg-red-50 rounded\">\n                    Remove Photo\n                  </button>\n                </div>\n              </div>\n              \n              <!-- Final Photo Upload Options -->\n              <div v-if=\"!finalize.finalPhotoFile\" class=\"space-y-4\">\n                <div class=\"flex flex-col sm:flex-row gap-3 justify-center\">\n                  <!-- File Upload -->\n                  <label class=\"flex-1 cursor-pointer\">\n                    <input type=\"file\" \n                           @change=\"onFinalPhotoSelected\" \n                           accept=\"image/*\" \n                           class=\"hidden\" />\n                    <div class=\"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors text-center text-sm\">\n                      üìÅ Upload Photo\n                    </div>\n                  </label>\n                  \n                  <!-- Scanner -->\n                  <button @click=\"scanFinalPhoto\" \n                          :disabled=\"scanning\"\n                          class=\"flex-1 px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors text-sm\">\n                    <span v-if=\"scanning\">üîÑ Scanning...</span>\n                    <span v-else>üì∑ Scan Photo</span>\n                  </button>\n                </div>\n                \n                <!-- Drag & Drop Instructions -->\n                <div class=\"text-gray-500 text-xs\">\n                  <p>Or drag and drop a photo file here</p>\n                </div>\n              </div>\n            </div>\n          </div>\n          <div class=\"md:col-span-3\">\n            <label class=\"block text-sm text-gray-700 mb-2\">Discount (Rs)</label>\n            <input type=\"number\" step=\"0.01\" class=\"w-full px-3 py-2 border rounded\" v-model.number=\"invoice.totalDiscountAmount\" />\n          </div>\n        </div>\n\n        <div v-if=\"finalize.type==='purchase'\" class=\"mt-6\">\n          <div class=\"flex justify-between items-center mb-4\">\n            <h3 class=\"font-semibold\">Leakages & Bursts (per item)</h3>\n            <div v-if=\"deletedRows.length > 0\" class=\"flex items-center gap-2\">\n              <Button theme=\"blue\" variant=\"outline\" size=\"sm\" @click=\"undoLastDelete\" class=\"hover:bg-blue-50\">\n                <span class=\"mr-1 text-blue-600\">‚Ü∂</span> Undo Delete ({{ deletedRows.length }})\n              </Button>\n            </div>\n          </div>\n          \n          <!-- Validation Status Summary -->\n          <div v-if=\"itemValidation\" class=\"mb-4 p-3 rounded-md\" \n               :class=\"itemValidation.all_valid ? 'bg-green-50 border border-green-200' : 'bg-yellow-50 border border-yellow-200'\">\n            <div class=\"flex items-center justify-between\">\n              <div class=\"flex items-center\">\n                <div v-if=\"itemValidation.all_valid\" class=\"flex-shrink-0 w-5 h-5 text-green-400\">\n                  ‚úì\n                </div>\n                <div v-else class=\"flex-shrink-0 w-5 h-5 text-yellow-400\">\n                  ‚ö†\n                </div>\n                <div class=\"ml-3\">\n                  <p class=\"text-sm font-medium\" \n                     :class=\"itemValidation.all_valid ? 'text-green-800' : 'text-yellow-800'\">\n                    {{ itemValidation.all_valid ? 'All items are valid' : `${itemValidation.missing_items.length} items need to be added to master data` }}\n                  </p>\n                  <p v-if=\"!itemValidation.all_valid\" class=\"text-sm text-yellow-700 mt-1\">\n                    Use the \"+\" button next to missing items to add them to the master data. After adding items, click \"Re-validate Items\" to check again.\n                  </p>\n                </div>\n              </div>\n              <div class=\"flex space-x-2\">\n                <Button theme=\"blue\" variant=\"outline\" size=\"sm\" @click=\"validateItems\">\n                  Re-validate Items\n                </Button>\n                <Button theme=\"gray\" variant=\"outline\" size=\"sm\" @click=\"resetItemStatuses\">\n                  Reset Statuses\n                </Button>\n              </div>\n            </div>\n          </div>\n          \n          <!-- Manual Validation Button (when no validation status) -->\n          <div v-else-if=\"invoice?.items?.length > 0\" class=\"mb-4 p-3 rounded-md bg-gray-50 border border-gray-200\">\n            <div class=\"flex items-center justify-between\">\n              <div class=\"flex items-center\">\n                <div class=\"flex-shrink-0 w-5 h-5 text-gray-400\">\n                  ‚Ñπ\n                </div>\n                <div class=\"ml-3\">\n                  <p class=\"text-sm font-medium text-gray-800\">\n                    Validate items before creating invoice\n                  </p>\n                  <p class=\"text-sm text-gray-600 mt-1\">\n                    Click the button to check if all items exist in master data. Validation only runs when you click this button or the \"Create Invoice\" button.\n                  </p>\n                </div>\n              </div>\n              <Button theme=\"blue\" variant=\"outline\" size=\"sm\" @click=\"validateItems\" class=\"ml-4\">\n                Validate Items\n              </Button>\n            </div>\n          </div>\n          \n          <div class=\"overflow-x-auto border border-gray-200 rounded-lg\">\n            <table class=\"min-w-full divide-y divide-gray-200\">\n              <thead class=\"bg-gray-50\">\n                <tr>\n                  <th class=\"px-2 sm:px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-32 sm:w-48\">Code</th>\n                  <th class=\"px-2 sm:px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-48 sm:w-80\">Description</th>\n                  <th class=\"px-2 sm:px-3 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider w-20 sm:w-24\">Qty</th>\n                  <th class=\"px-2 sm:px-3 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider w-20 sm:w-24\">UOM</th>\n                  <th class=\"px-2 sm:px-3 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider w-20 sm:w-24\">Leakages</th>\n                  <th class=\"px-2 sm:px-3 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider w-20 sm:w-24\">Bursts</th>\n                  <th class=\"px-2 sm:px-3 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider w-16\">Actions</th>\n                </tr>\n              </thead>\n              <tbody class=\"bg-white divide-y divide-gray-200\">\n                <tr v-for=\"(it, idx) in invoice.items\" :key=\"idx\" \n                    :class=\"{'hover:bg-gray-50': true, 'bg-red-50': it.isMissing, 'bg-green-50': it.itemCreated}\">\n                  <td class=\"px-2 sm:px-3 py-3 text-sm\">\n                    <div class=\"flex items-center space-x-2\">\n                      <input class=\"w-full px-2 sm:px-3 py-2 border rounded text-sm\" \n                             v-model=\"it.materialCode\" \n                             :class=\"{'border-red-500': it.isMissing, 'border-green-500': it.itemCreated}\"\n                             placeholder=\"Item Code\" />\n                      <!-- Add button for missing items -->\n                      <button v-if=\"it.isMissing && !it.itemCreated\"\n                              @click=\"openNewItemDialog(idx)\"\n                              class=\"flex-shrink-0 w-8 h-8 bg-blue-500 hover:bg-blue-600 text-white rounded-full flex items-center justify-center text-lg font-bold transition-colors add-button\">\n                        +\n                      </button>\n                      <!-- Success checkmark for created items -->\n                      <span v-if=\"it.itemCreated\" class=\"flex-shrink-0 w-8 h-8 bg-green-500 text-white rounded-full flex items-center justify-center text-sm\">\n                        ‚úì\n                      </span>\n                    </div>\n                  </td>\n                  <td class=\"px-2 sm:px-3 py-3 text-sm\">\n                    <input class=\"w-full px-2 sm:px-3 py-2 border rounded text-sm\" \n                           v-model=\"it.materialDescription\" \n                           placeholder=\"Description\" />\n                  </td>\n                  <td class=\"px-2 sm:px-3 py-3 text-sm text-center\">\n                    <input type=\"number\" class=\"w-16 sm:w-20 px-2 sm:px-3 py-2 border rounded text-center\" \n                           v-model.number=\"it.salesQty\" inputmode=\"numeric\" />\n                  </td>\n                  <td class=\"px-2 sm:px-3 py-3 text-sm text-center\">\n                    <select v-model=\"it.uom\" class=\"px-2 sm:px-3 py-2 border rounded text-center w-16 sm:w-20\">\n                      <option value=\"CS\">CS</option>\n                      <option value=\"Nos\">Nos</option>\n                    </select>\n                  </td>\n                  <td class=\"px-2 sm:px-3 py-3 text-sm text-center\">\n                    <input type=\"number\" min=\"0\" class=\"w-16 sm:w-20 px-2 sm:px-3 py-2 border rounded text-center\" \n                           v-model.number=\"finalize.items[idx].leakages\" inputmode=\"numeric\" />\n                  </td>\n                  <td class=\"px-2 sm:px-3 py-3 text-center\">\n                    <input type=\"number\" min=\"0\" class=\"w-16 sm:w-20 px-2 sm:px-3 py-2 border rounded text-center\" \n                           v-model.number=\"finalize.items[idx].bursts\" inputmode=\"numeric\" />\n                  </td>\n                  <td class=\"px-2 sm:px-3 py-3 text-sm text-center\">\n                    <Button theme=\"red\" variant=\"outline\" size=\"sm\" @click=\"deleteRow(idx)\" class=\"text-red-600 hover:text-red-700\">\n                      <span class=\"text-xs\">üóëÔ∏è</span>\n                    </Button>\n                  </td>\n                </tr>\n              </tbody>\n            </table>\n          </div>\n        </div>\n\n        <div class=\"mt-6 flex justify-end\">\n          <Button theme=\"green\" \n                  :loading=\"submitting || isProcessing\" \n                  :disabled=\"!finalize.type || isProcessing\" \n                  @click=\"confirmAndSubmit\">\n            {{ isProcessing ? 'Processing...' : `Create ${finalize.type==='purchase' ? 'Purchase' : 'Sales'} Invoice` }}\n          </Button>\n        </div>\n      </div>\n    </div>\n  </div>\n  \n  <!-- New Item Creation Dialog -->\n  <div v-if=\"showNewItemDialog\" class=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n    <div class=\"bg-white rounded-lg shadow-xl max-w-md w-full max-h-[90vh] overflow-y-auto\">\n      <div class=\"px-6 py-4 border-b border-gray-200\">\n        <h3 class=\"text-lg font-medium text-gray-900\">Create New Item</h3>\n        <p class=\"text-sm text-gray-500 mt-1\">Add this item to the master data</p>\n      </div>\n      \n      <div class=\"px-6 py-4 space-y-4\">\n        <!-- Item Code -->\n        <div>\n          <label class=\"block text-sm font-medium text-gray-700 mb-1\">Item Code *</label>\n          <input type=\"text\" \n                 v-model=\"newItemData.item_code\" \n                 class=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                 placeholder=\"Enter item code\" />\n        </div>\n        \n        <!-- Item Name -->\n        <div>\n          <label class=\"block text-sm font-medium text-gray-700 mb-1\">Item Name *</label>\n          <input type=\"text\" \n                 v-model=\"newItemData.item_name\" \n                 class=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                 placeholder=\"Enter item name\" />\n        </div>\n        \n        <!-- Selling Price -->\n        <div>\n          <label class=\"block text-sm font-medium text-gray-700 mb-1\">Selling Price</label>\n          <input type=\"number\" \n                 v-model.number=\"newItemData.selling_price\" \n                 step=\"0.01\" min=\"0\"\n                 class=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                 placeholder=\"0.00\" />\n        </div>\n        \n        <!-- Valuation Price -->\n        <div>\n          <label class=\"block text-sm font-medium text-gray-700 mb-1\">Valuation Price *</label>\n          <input type=\"number\" \n                 v-model.number=\"newItemData.valuation_price\" \n                 step=\"0.01\" min=\"0\"\n                 class=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500\"\n                 placeholder=\"0.00\" />\n        </div>\n        \n        <!-- UOM Conversion -->\n        <div>\n          <label class=\"block text-sm font-medium text-gray-700 mb-1\">Nos in CS (UOM Conversion)</label>\n          <input type=\"number\" \n                 v-model.number=\"newItemData.uom_conversion\" \n                 min=\"1\" step=\"1\"\n                 class=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                 placeholder=\"6\" />\n          <p class=\"text-xs text-gray-500 mt-1\">How many Nos (pieces) are in 1 CS (Case)</p>\n        </div>\n      </div>\n      \n      <div class=\"px-6 py-4 border-t border-gray-200 flex justify-end space-x-3\">\n        <button @click=\"showNewItemDialog = false\" \n                class=\"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md transition-colors\">\n          Cancel\n        </button>\n        <button @click=\"createNewItem\" \n                class=\"px-4 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 rounded-md transition-colors\">\n          Create Item\n        </button>\n      </div>\n    </div>\n  </div>\n\n  <!-- Last Invoices Dialog -->\n  <div v-if=\"showLastInvoicesDialog\" class=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n    <div class=\"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto\">\n      <div class=\"px-6 py-4 border-b border-gray-200\">\n        <h3 class=\"text-lg font-medium text-gray-900\">Last 3 {{ finalize.type === 'purchase' ? 'Purchase' : 'Sales' }} Invoices</h3>\n        <p class=\"text-sm text-gray-500 mt-1\">Showing the most recent invoices by posting date</p>\n      </div>\n      \n      <div class=\"px-6 py-4\">\n        <div v-if=\"loadingLastInvoices\" class=\"flex justify-center items-center py-8\">\n          <div class=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600\"></div>\n          <span class=\"ml-3 text-gray-600\">Loading invoices...</span>\n        </div>\n        \n        <div v-else-if=\"lastInvoices.length === 0\" class=\"text-center py-8\">\n          <div class=\"text-gray-400 text-6xl mb-4\">üìÑ</div>\n          <p class=\"text-gray-600\">No {{ finalize.type === 'purchase' ? 'purchase' : 'sales' }} invoices found</p>\n        </div>\n        \n        <div v-else class=\"space-y-4\">\n          <div v-for=\"invoice in lastInvoices\" :key=\"invoice.name\" \n               class=\"border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-colors\">\n            <div class=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n              <div>\n                <label class=\"block text-sm font-medium text-gray-700 mb-1\">Invoice Name</label>\n                <p class=\"text-sm text-gray-900 font-mono\">{{ invoice.name }}</p>\n              </div>\n              <div>\n                <label class=\"block text-sm font-medium text-gray-700 mb-1\">Posting Date</label>\n                <p class=\"text-sm text-gray-900\">{{ formatDate(invoice.posting_date) }}</p>\n              </div>\n              <div>\n                <label class=\"block text-sm font-medium text-gray-700 mb-1\">Amount</label>\n                <p class=\"text-sm text-gray-900 font-semibold\">‚Çπ{{ formatAmount(invoice.grand_total) }}</p>\n              </div>\n              <div>\n                <label class=\"block text-sm font-medium text-gray-700 mb-1\">Status</label>\n                <span class=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium\"\n                      :class=\"getStatusClass(invoice.docstatus)\">\n                  {{ getStatusText(invoice.docstatus) }}\n                </span>\n              </div>\n            </div>\n            <div v-if=\"finalize.type === 'purchase' && invoice.bill_no\" class=\"mt-3 pt-3 border-t border-gray-100\">\n              <div>\n                <label class=\"block text-xs font-medium text-gray-500 mb-1\">Supplier Invoice No</label>\n                <p class=\"text-sm text-gray-900\">{{ invoice.bill_no }}</p>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n      \n      <div class=\"px-6 py-4 border-t border-gray-200 flex justify-end\">\n        <button @click=\"showLastInvoicesDialog = false\" \n                class=\"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md transition-colors\">\n          Close\n        </button>\n      </div>\n    </div>\n  </div>\n  \n</template>\n\n<script setup>\nimport { ref, reactive, onMounted, watch, computed } from 'vue'\nimport { createResource } from 'frappe-ui'\nimport { session } from '@/data/session'\n\nconst selectedFile = ref(null)\nconst selectedFileName = ref('')\nconst capturedDataUrl = ref('')\nconst extractError = ref('')\nconst extracting = ref(false)\nconst invoice = ref(null)\nconst submitting = ref(false)\n\n// Scanner configuration\nconst scannerConfig = reactive({\n  connectionUrl: 'http://localhost:17890',\n  dpi: 300\n})\n\n// Drag and drop states\nconst isDragOver = ref(false)\nconst isFinalPhotoDragOver = ref(false)\n\n// Scanner states\nconst scanning = ref(false)\nconst scannedImageBlob = ref(null)\nconst scannedImageUrl = ref('')\n\n// Optimized image preview URL management\nconst imagePreviewUrl = computed(() => {\n  if (selectedFile.value) return URL.createObjectURL(selectedFile.value)\n  if (capturedDataUrl.value) return capturedDataUrl.value\n  if (scannedImageBlob.value) return URL.createObjectURL(scannedImageBlob.value)\n  if (scannedImageUrl.value) return scannedImageUrl.value\n  return null\n})\n\nconst finalPhotoPreviewUrl = computed(() => {\n  if (finalize.finalPhotoFile) return URL.createObjectURL(finalize.finalPhotoFile)\n  return null\n})\n\nconst finalize = reactive({\n  type: 'purchase', // default purchase\n  billAmount: null,\n  finalPhotoFile: null,\n  supplierName: 'bntl',\n  items: [],\n  isReturn: false, // New field for return/credit note\n})\n\n// Track deleted rows for undo functionality\nconst deletedRows = ref([])\n\n// Item validation and new item creation\nconst itemValidation = ref(null)\nconst showNewItemDialog = ref(false)\nconst newItemData = reactive({\n  item_code: '',\n  item_name: '',\n  selling_price: 0,\n  valuation_price: 0,\n  uom_conversion: 6, // Default CS = 6 Nos\n  rowIndex: -1\n})\n\n// Add invoice type detection\nconst invoiceType = ref('') // 'tax_invoice' or 'credit_note'\nconst isProcessing = ref(false) // Prevent multiple submissions\nconst detectionMethod = ref('') // 'title' or 'inferred'\n\n// Last invoices functionality\nconst showLastInvoicesDialog = ref(false)\nconst loadingLastInvoices = ref(false)\nconst lastInvoices = ref([])\n\n// Camera variables removed - replaced with scanner functionality\n\nconst onFileSelected = (e) => {\n  const f = e?.target?.files?.[0]\n  if (!f) return\n  selectedFile.value = f\n  selectedFileName.value = f.name\n  capturedDataUrl.value = ''\n}\n\nconst onFinalPhotoSelected = (e) => {\n  const f = e?.target?.files?.[0]\n  if (f) finalize.finalPhotoFile = f\n}\n\n// Drag and drop functions\nconst onDrop = (e) => {\n  e.preventDefault()\n  isDragOver.value = false\n  \n  const files = Array.from(e.dataTransfer.files)\n  const imageFile = files.find(file => file.type.startsWith('image/'))\n  \n  if (imageFile) {\n    selectedFile.value = imageFile\n    selectedFileName.value = imageFile.name\n    capturedDataUrl.value = ''\n    scannedImageBlob.value = null\n    scannedImageUrl.value = ''\n  }\n}\n\nconst onDragLeave = () => {\n  isDragOver.value = false\n}\n\nconst onFinalPhotoDrop = (e) => {\n  e.preventDefault()\n  isFinalPhotoDragOver.value = false\n  \n  const files = Array.from(e.dataTransfer.files)\n  const imageFile = files.find(file => file.type.startsWith('image/'))\n  \n  if (imageFile) {\n    finalize.finalPhotoFile = imageFile\n  }\n}\n\nconst onFinalPhotoDragLeave = () => {\n  isFinalPhotoDragOver.value = false\n}\n\n// Scanner functions\nconst scan = async () => {\n  try {\n    scanning.value = true;\n\n    // Trigger scan\n    const res = await fetch(`${scannerConfig.connectionUrl}/scan`, {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({\n        dpi: scannerConfig.dpi,\n        mode: 'Color'\n      })\n    });\n\n    if (!res.ok) {\n      const error = await res.text()\n      throw new Error(`Scan failed: ${error}`)\n    }\n\n    const { data, format } = await res.json();\n\n    const byteArray = Uint8Array.from(atob(data), c => c.charCodeAt(0));\n    const imageBlob = new Blob([byteArray], { type: `image/${format}` });\n    \n    // Set scanned image as the active source\n    scannedImageBlob.value = imageBlob;\n    scannedImageUrl.value = URL.createObjectURL(imageBlob);\n    \n    // Debug logging\n    console.log('Scan completed:', {\n      scannedImageBlob: !!scannedImageBlob.value,\n      scannedImageUrl: !!scannedImageUrl.value,\n      imagePreviewUrl: imagePreviewUrl.value,\n      canExtract: canExtract.value\n    });\n    \n    // Clear other image sources to avoid confusion\n    selectedFile.value = null;\n    selectedFileName.value = '';\n    capturedDataUrl.value = '';\n\n    alert('Document scanned successfully!');\n  } catch (err) {\n    alert('Scan failed: ' + err.message);\n  } finally {\n    scanning.value = false;\n  }\n}\n\nconst scanFinalPhoto = async () => {\n  try {\n    scanning.value = true;\n\n    // Trigger scan\n    const res = await fetch(`${scannerConfig.connectionUrl}/scan`, {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({\n        dpi: scannerConfig.dpi,\n        mode: 'Color'\n      })\n    });\n\n    if (!res.ok) {\n      const error = await res.text()\n      throw new Error(`Scan failed: ${error}`)\n    }\n\n    const { data, format } = await res.json();\n\n    const byteArray = Uint8Array.from(atob(data), c => c.charCodeAt(0));\n    const imageBlob = new Blob([byteArray], { type: `image/${format}` });\n\n    // Correctly update finalize.finalPhotoFile for the attachment preview\n    finalize.finalPhotoFile = new File([imageBlob], `scanned_photo.${format}`, { type: `image/${format}` });\n\n    alert('Photo scanned successfully!');\n  } catch (err) {\n    alert('Scan failed: ' + err.message);\n  } finally {\n    scanning.value = false;\n  }\n}\n\n// Enhanced image cleanup function\nconst clearImage = () => {\n  // Revoke object URLs to prevent memory leaks\n  if (scannedImageUrl.value) {\n    URL.revokeObjectURL(scannedImageUrl.value)\n  }\n  \n  // Clear all image references\n  selectedFile.value = null\n  selectedFileName.value = ''\n  capturedDataUrl.value = ''\n  scannedImageBlob.value = null\n  scannedImageUrl.value = ''\n  \n  // Force garbage collection if available\n  if (window.gc) {\n    window.gc()\n  }\n}\n\nconst clearFinalPhoto = () => {\n  if (finalize.finalPhotoFile) {\n    finalize.finalPhotoFile = null\n  }\n  \n  // Force garbage collection if available\n  if (window.gc) {\n    window.gc()\n  }\n}\n\n// Camera functions removed - replaced with scanner functionality\n\nconst canExtract = computed(() => {\n  return !!selectedFile.value || !!capturedDataUrl.value || !!scannedImageBlob.value || !!scannedImageUrl.value\n})\n\nconst safeJson = async (res) => {\n  try {\n    const text = await res.text()\n    if (!text) return {}\n    try { return JSON.parse(text) } catch (_) {}\n    // try strip code fences or trailing commas\n    const cleaned = text.trim().replace(/^```(?:json)?/i, '').replace(/```$/, '')\n    return JSON.parse(cleaned)\n  } catch (e) { return {} }\n}\n\n// Memory management utilities\nconst memoryMonitor = {\n  checkMemoryUsage: () => {\n    if ('memory' in performance) {\n      const memory = performance.memory\n      const usedMB = Math.round(memory.usedJSHeapSize / 1024 / 1024)\n      const totalMB = Math.round(memory.totalJSHeapSize / 1024 / 1024)\n      const limitMB = Math.round(memory.jsHeapSizeLimit / 1024 / 1024)\n      \n      console.log(`Memory Usage: ${usedMB}MB / ${totalMB}MB (${limitMB}MB limit)`)\n      \n      // Warn if memory usage is high\n      if (usedMB > limitMB * 0.8) {\n        console.warn('High memory usage detected! Consider clearing some data.')\n        return false\n      }\n      return true\n    }\n    return true\n  },\n  \n  forceCleanup: () => {\n    // Clear any cached data\n    if (window.gc) {\n      window.gc()\n    }\n    \n    // Clear any stored data that might be taking up memory\n    try {\n      localStorage.clear()\n      sessionStorage.clear()\n    } catch (e) {\n      console.warn('Could not clear storage:', e)\n    }\n  }\n}\n\n// Enhanced robust fetch with memory monitoring\nconst robustFetch = async (url, opts = {}) => {\n  const maxRetries = 2\n  const retryDelays = [500, 1000]\n  \n  for (let attempt = 0; attempt <= maxRetries; attempt++) {\n    try {\n      // Check memory before making request\n      if (!memoryMonitor.checkMemoryUsage()) {\n        memoryMonitor.forceCleanup()\n      }\n      \n      const controller = new AbortController()\n      const timeout = setTimeout(() => controller.abort(), 30000)\n      const res = await fetch(url, { ...opts, signal: controller.signal })\n      clearTimeout(timeout)\n      \n      // Retry on transient gateways\n      if ([502, 503, 504].includes(res.status) && attempt < maxRetries) {\n        await new Promise(r => setTimeout(r, retryDelays[attempt]))\n        continue\n      }\n      return res\n    } catch (e) {\n      if (attempt < maxRetries) {\n        await new Promise(r => setTimeout(r, retryDelays[attempt]))\n        continue\n      }\n      throw new Error(e?.name === 'AbortError' ? 'Request timed out. Please try again.' : (e?.message || 'Network error'))\n    }\n  }\n}\n\nconst extractInvoice = async () => {\n  extractError.value = ''\n  extracting.value = true\n  invoice.value = null\n  invoiceType.value = '' // Reset invoice type\n  finalize.isReturn = false // Reset return flag\n  detectionMethod.value = '' // Reset detection method\n  try {\n    if (!finalize.type) throw new Error('Select invoice type first')\n    let res\n    if (selectedFile.value) {\n      const b64 = await toBase64(selectedFile.value)\n      res = await robustFetch('/api/method/custom_erp.custom_erp.purchase_invoice.api.extract_invoice', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ image_data: b64 })\n      })\n    } else if (capturedDataUrl.value) {\n      res = await robustFetch('/api/method/custom_erp.custom_erp.purchase_invoice.api.extract_invoice', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ image_data: capturedDataUrl.value })\n      })\n    } else if (scannedImageBlob.value) {\n      const b64 = await toBase64(scannedImageBlob.value)\n      res = await robustFetch('/api/method/custom_erp.custom_erp.purchase_invoice.api.extract_invoice', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ image_data: b64 })\n      })\n    } else {\n      throw new Error('No input')\n    }\n    const data = await safeJson(res)\n    const msg = data.message || data\n    if (!res.ok || !msg?.success) throw new Error(msg?.error || 'Extraction failed')\n    \n    // Debug: Log the full response\n    console.log('Full extraction response:', msg)\n    console.log('Extracted data:', msg.data)\n    \n    // Detect purchase invoice type from the extracted title\n    const title = msg.data?.title || ''\n    console.log('Extracted title:', title) // Debug log\n    \n    // Try to detect from title first\n    let detectedType = null\n    let method = 'inferred'\n    \n    if (title.toLowerCase().includes('credit note')) {\n      detectedType = 'credit_note'\n      method = 'title'\n      console.log('Detected Credit Note from title')\n    } else if (title.toLowerCase().includes('tax invoice')) {\n      detectedType = 'tax_invoice'\n      method = 'title'\n      console.log('Detected Tax Invoice from title')\n    }\n    \n    // If title detection failed, try to infer from other fields\n    if (!detectedType) {\n      console.log('Title detection failed, trying to infer from other fields...')\n      // Check if there are any negative amounts that might indicate a credit note\n      // Note: We don't check for negative quantities anymore since we always make them positive\n      const hasNegativeValues = msg.data?.items?.some(item => \n        (item.lineTotal && item.lineTotal < 0)\n      )\n      \n      if (hasNegativeValues) {\n        detectedType = 'credit_note'\n        method = 'inferred'\n        console.log('Inferred Credit Note from negative line totals')\n      } else {\n        detectedType = 'tax_invoice'\n        method = 'inferred'\n        console.log('Defaulting to Tax Invoice')\n      }\n    }\n    \n    // Set the invoice type and return flag\n    invoiceType.value = detectedType\n    finalize.isReturn = detectedType === 'credit_note'\n    detectionMethod.value = method\n    \n    console.log('Final decision:', {\n      detectedType,\n      isReturn: finalize.isReturn,\n      title: title,\n      method: method\n    })\n    \n    // Ensure editable model with safe defaults\n    invoice.value = {\n      invoiceNumber: msg.data?.invoiceNumber || '',\n      invoiceDate: normalizeDateToISO(msg.data?.invoiceDate || ''),\n      customerName: 'bntl',\n      items: Array.isArray(msg.data?.items) ? msg.data.items.map(it => ({\n        materialCode: it.materialCode || it.materialDescription || '',\n        materialDescription: it.materialDescription || it.materialCode || '',\n        salesQty: Math.abs(Number(it.salesQty || 0)), // Always make quantity positive\n        uom: it.uom || 'CS',\n        unitPrice: it.unitPrice,\n        lineTotal: it.lineTotal,\n        isMissing: false,\n        itemCreated: false,\n      })) : [],\n      totalAmount: Number(msg.data?.totalAmount || 0),\n      totalDiscountAmount: Number(msg.data?.totalDiscountAmount || 0),\n    }\n    // Prepare finalize items\n    finalize.items = (invoice.value.items || []).map(() => ({ leakages: 0, bursts: 0 }))\n    finalize.type = finalize.type || msg.invoiceType || 'purchase'\n    // Auto-set billed actual from extracted total\n    if (invoice.value.totalAmount && (finalize.billAmount === null || finalize.billAmount === undefined)) {\n      finalize.billAmount = invoice.value.totalAmount\n    }\n    \n    // Don't auto-validate - let user validate when ready\n  } catch (e) {\n    extractError.value = e?.message || 'Failed to extract invoice'\n  } finally {\n    extracting.value = false\n  }\n}\n\nconst toBase64 = (file) => new Promise((resolve, reject) => {\n  const reader = new FileReader()\n  reader.onload = () => {\n    const result = String(reader.result)\n    // Clear the reader to free memory\n    reader.onload = null\n    reader.onerror = null\n    resolve(result)\n  }\n  reader.onerror = (error) => {\n    reader.onload = null\n    reader.onerror = null\n    reject(error)\n  }\n  reader.readAsDataURL(file)\n})\n\nfunction normalizeDateToISO(input) {\n  if (!input) return new Date().toISOString().slice(0, 10)\n  // Already ISO yyyy-mm-dd\n  if (/^\\d{4}-\\d{2}-\\d{2}$/.test(input)) return input\n  // dd/mm/yyyy or dd-mm-yyyy or dd.mm.yyyy\n  let m = input.match(/^(\\d{1,2})[\\/.\\-](\\d{1,2})[\\/.\\-](\\d{4})$/)\n  if (m) {\n    const d = m[1].padStart(2, '0')\n    const mo = m[2].padStart(2, '0')\n    const y = m[3]\n    // If first is >12, treat as dd/mm; else assume dd/mm as well per requirement\n    return `${y}-${mo}-${d}`\n  }\n  // mm/dd/yyyy (rare). If matches and first <=12, flip.\n  m = input.match(/^(\\d{1,2})\\/(\\d{1,2})\\/(\\d{4})$/)\n  if (m) {\n    const mo = m[1].padStart(2, '0')\n    const d = m[2].padStart(2, '0')\n    const y = m[3]\n    return `${y}-${mo}-${d}`\n  }\n  // Fallback: try Date.parse\n  const t = Date.parse(input)\n  if (!isNaN(t)) return new Date(t).toISOString().slice(0, 10)\n  return new Date().toISOString().slice(0, 10)\n}\n\nconst parseMsg = (obj) => (obj && (obj.message ?? obj)) || {}\n\nconst submitInvoice = async () => {\n  if (!invoice.value || !finalize.type || isProcessing.value) return\n  \n  isProcessing.value = true\n  submitting.value = true\n  \n  try {\n    // Check memory before starting\n    if (!memoryMonitor.checkMemoryUsage()) {\n      memoryMonitor.forceCleanup()\n    }\n    \n    // Create payload with minimal memory footprint\n    const payload = {\n      invoiceNumber: invoice.value.invoiceNumber,\n      invoiceDate: invoice.value.invoiceDate,\n      customerName: 'bntl',\n      supplier: finalize.supplierName || 'bntl',\n      discount_amount: invoice.value.totalDiscountAmount || 0,\n      isReturn: finalize.isReturn,\n      items: []\n    }\n    \n    // Process items efficiently to reduce memory usage\n    const items = invoice.value.items || []\n    for (let i = 0; i < items.length; i++) {\n      const it = items[i]\n      const item = {\n        materialCode: it.materialCode,\n        materialDescription: it.materialDescription,\n        salesQty: it.salesQty,\n        uom: it.uom,\n        unitPrice: it.unitPrice,\n        lineTotal: it.lineTotal,\n      }\n      \n      // Add purchase-specific fields only if needed\n      if (finalize.type === 'purchase') {\n        item.leakages = finalize.items[i]?.leakages || 0\n        item.bursts = finalize.items[i]?.bursts || 0\n      }\n      \n      payload.items.push(item)\n    }\n    \n    // Add optional fields\n    if (finalize.type === 'purchase') {\n      if (finalize.billAmount) payload.cust_bill_actual_amount = finalize.billAmount\n      if (finalize.finalPhotoFile) {\n        // Process photo with memory optimization\n        payload.photo_base64 = await toBase64(finalize.finalPhotoFile)\n      }\n    }\n    \n    // Check memory again before API call\n    if (!memoryMonitor.checkMemoryUsage()) {\n      memoryMonitor.forceCleanup()\n    }\n    \n    // Make API call with retry logic\n    let res\n    if (finalize.type === 'purchase') {\n      res = await robustFetch('/api/method/custom_erp.custom_erp.purchase_invoice.api.create_purchase_invoice', {\n        method: 'POST', \n        headers: { 'Content-Type': 'application/json' }, \n        body: JSON.stringify({ payload })\n      })\n    } else {\n      res = await robustFetch('/api/method/custom_erp.custom_erp.sales_invoice.api.create_sales_invoice', {\n        method: 'POST', \n        headers: { 'Content-Type': 'application/json' }, \n        body: JSON.stringify({ payload })\n      })\n    }\n    \n    const raw = await safeJson(res)\n    const j = parseMsg(raw)\n    \n    if (!res.ok || !j?.success) {\n      throw new Error(j?.error || `Failed to create ${finalize.type === 'purchase' ? 'Purchase' : 'Sales'} Invoice`)\n    }\n    \n    window.alert(`${finalize.type === 'purchase' ? 'Purchase' : 'Sales'} Invoice Created: ${j?.name}`)\n    \n    // Clear memory after successful creation\n    payload.items = null\n    if (payload.photo_base64) {\n      payload.photo_base64 = null\n    }\n    \n    // Force cleanup after successful creation\n    memoryMonitor.forceCleanup()\n    \n  } catch (e) {\n    // As a safety net, verify whether the invoice actually got created\n    try {\n      const verify = await checkForDuplicateInvoice(true)\n      if (verify?.existingName) {\n        window.alert(`${finalize.type === 'purchase' ? 'Purchase' : 'Sales'} Invoice Created: ${verify.existingName}`)\n      } else {\n        throw new Error(e?.message || 'Failed')\n      }\n    } catch (vErr) {\n      window.alert(`Error: ${e?.message || 'Failed'}`)\n    }\n  } finally {\n    submitting.value = false\n    isProcessing.value = false\n    \n    // Final cleanup\n    memoryMonitor.forceCleanup()\n  }\n}\n\nconst validateItems = async () => {\n  try {\n    // Reset all item statuses first\n    invoice.value.items.forEach(item => {\n      item.isMissing = false\n      item.itemCreated = false\n    })\n    \n    // Debug: Log what we're sending\n    console.log('Sending items for validation:', invoice.value.items)\n    console.log('Items type:', typeof invoice.value.items)\n    console.log('Items length:', invoice.value.items?.length)\n    console.log('JSON stringified:', JSON.stringify(invoice.value.items))\n    console.log('Final request body:', JSON.stringify({ items: JSON.stringify(invoice.value.items) }))\n    \n    const res = await robustFetch('/api/method/custom_erp.custom_erp.purchase_invoice.api.validate_items_master', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ items: JSON.stringify(invoice.value.items) })\n    })\n    \n    // Debug: Log response\n    console.log('Validation response status:', res.status)\n    \n    const data = await safeJson(res)\n    console.log('Validation response data:', data)\n    \n    const msg = data.message || data\n    if (!res.ok || !msg.success) throw new Error(msg.error || 'Validation failed')\n    \n    // Update item statuses based on validation results\n    if (msg.validation && msg.validation.missing_items) {\n      msg.validation.missing_items.forEach(missingItem => {\n        const item = invoice.value.items.find(it => it.materialCode === missingItem.materialCode)\n        if (item) {\n          item.isMissing = true\n        }\n      })\n    }\n    \n    itemValidation.value = msg.validation\n    return msg.validation\n  } catch (e) {\n    console.error('Validation error:', e)\n    window.alert(`Validation error: ${e?.message || 'Failed to validate items'}`)\n    return { all_valid: false, missing_items: [], valid_items: [] }\n  }\n}\n\nconst showMissingItemsDialog = (missingItems) => {\n  // Mark missing items in the UI\n  invoice.value.items.forEach((item, index) => {\n    const isMissing = missingItems.some(missing => missing.materialCode === item.materialCode)\n    item.isMissing = isMissing\n  })\n  \n  const missingCodes = missingItems.map(item => item.materialCode).join(', ')\n  const ok = window.confirm(\n    `The following items are not found in master data:\\n\\n${missingCodes}\\n\\n` +\n    `Please add them as new items using the \"+\" button, or correct the item codes if there are typos.`\n  )\n}\n\nconst openNewItemDialog = (rowIndex) => {\n  const item = invoice.value.items[rowIndex]\n  newItemData.item_code = item.materialCode\n  newItemData.item_name = item.materialDescription\n  newItemData.rowIndex = rowIndex\n  newItemData.selling_price = item.unitPrice || 0\n  newItemData.valuation_price = item.unitPrice || 0\n  newItemData.uom_conversion = item.uom === 'CS' ? 6 : 1\n  showNewItemDialog.value = true\n}\n\nconst createNewItem = async () => {\n  try {\n    const res = await fetch('/api/method/custom_erp.custom_erp.purchase_invoice.api.create_new_item_for_invoice', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ item_data: JSON.stringify(newItemData) })\n    })\n    const data = await safeJson(res)\n    const msg = data.message || data\n    if (!res.ok || !msg.success) throw new Error(msg.error || 'Failed to create item')\n    \n    // Mark item as valid and remove add button\n    const rowIndex = newItemData.rowIndex\n    if (rowIndex >= 0 && rowIndex < invoice.value.items.length) {\n      invoice.value.items[rowIndex].isMissing = false\n      invoice.value.items[rowIndex].itemCreated = true\n    }\n    \n    showNewItemDialog.value = false\n    window.alert(`Item created successfully: ${msg.item_code}`)\n    \n    // Re-validate items\n    await validateItems()\n    \n  } catch (e) {\n    window.alert(`Error creating item: ${e?.message || 'Failed'}`)\n  }\n}\n\nconst handleItemCodeChange = (item, index) => {\n  // Reset item status when code changes\n  item.isMissing = false\n  item.itemCreated = false\n}\n\nconst onItemCodeChange = (item, index) => {\n  // This function can be called when item code changes to reset status\n  handleItemCodeChange(item, index)\n}\n\nconst resetItemStatuses = () => {\n  // Reset all item statuses\n  invoice.value.items.forEach(item => {\n    item.isMissing = false\n    item.itemCreated = false\n  })\n  itemValidation.value = null\n}\n\nconst checkForDuplicateInvoice = async (returnName = false) => {\n  try {\n    const apiEndpoint = finalize.type === 'purchase' \n      ? '/api/method/custom_erp.custom_erp.purchase_invoice.api.check_duplicate_invoice'\n      : '/api/method/custom_erp.custom_erp.sales_invoice.api.check_duplicate_invoice'\n    \n    const res = await robustFetch(apiEndpoint, {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({\n        supplier: finalize.supplierName,\n        customer: finalize.supplierName,\n        invoice_number: invoice.value.invoiceNumber,\n        invoice_date: invoice.value.invoiceDate,\n        invoice_type: finalize.type\n      })\n    })\n    \n    const raw = await safeJson(res)\n    const msg = parseMsg(raw)\n    \n    if (!res.ok) return { isDuplicate: false }\n    \n    return { isDuplicate: !!msg.isDuplicate, existingName: msg.existing_invoice || null }\n  } catch (e) {\n    return { isDuplicate: false }\n  }\n}\n\nconst deleteRow = (index) => {\n  if (!invoice.value?.items || index < 0 || index >= invoice.value.items.length) return\n  \n  // Store the deleted row data for undo\n  const deletedRow = {\n    index: index,\n    item: { ...invoice.value.items[index] },\n    finalizeItem: { ...finalize.items[index] }\n  }\n  \n  // Remove from invoice items\n  invoice.value.items.splice(index, 1)\n  \n  // Remove from finalize items\n  finalize.items.splice(index, 1)\n  \n  // Add to deleted rows stack\n  deletedRows.value.push(deletedRow)\n}\n\nconst undoLastDelete = () => {\n  if (deletedRows.value.length === 0) return\n  \n  // Get the last deleted row\n  const lastDeleted = deletedRows.value.pop()\n  \n  // Insert back at the original position\n  invoice.value.items.splice(lastDeleted.index, 0, lastDeleted.item)\n  finalize.items.splice(lastDeleted.index, 0, lastDeleted.finalizeItem)\n}\n\n// Last invoices functions\nconst showLastInvoices = async () => {\n  if (!finalize.type) {\n    window.alert('Please select an invoice type first')\n    return\n  }\n  \n  showLastInvoicesDialog.value = true\n  await fetchLastInvoices()\n}\n\nconst fetchLastInvoices = async () => {\n  loadingLastInvoices.value = true\n  lastInvoices.value = []\n  \n  try {\n    const apiEndpoint = finalize.type === 'purchase' \n      ? '/api/method/custom_erp.custom_erp.purchase_invoice.api.get_last_invoices'\n      : '/api/method/custom_erp.custom_erp.sales_invoice.api.get_last_invoices'\n    \n    const res = await robustFetch(apiEndpoint, {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ limit: 3 })\n    })\n    \n    const data = await safeJson(res)\n    const msg = data.message || data\n    \n    if (!res.ok || !msg?.success) {\n      throw new Error(msg?.error || 'Failed to fetch invoices')\n    }\n    \n    lastInvoices.value = msg.invoices || []\n  } catch (e) {\n    console.error('Error fetching last invoices:', e)\n    window.alert(`Error fetching invoices: ${e?.message || 'Failed to fetch invoices'}`)\n  } finally {\n    loadingLastInvoices.value = false\n  }\n}\n\nconst formatDate = (dateString) => {\n  if (!dateString) return 'N/A'\n  try {\n    const date = new Date(dateString)\n    return date.toLocaleDateString('en-IN', {\n      year: 'numeric',\n      month: 'short',\n      day: 'numeric'\n    })\n  } catch (e) {\n    return dateString\n  }\n}\n\nconst formatAmount = (amount) => {\n  if (!amount && amount !== 0) return '0.00'\n  return Number(amount).toLocaleString('en-IN', {\n    minimumFractionDigits: 2,\n    maximumFractionDigits: 2\n  })\n}\n\nconst getStatusClass = (docstatus) => {\n  switch (docstatus) {\n    case 0:\n      return 'bg-yellow-100 text-yellow-800'\n    case 1:\n      return 'bg-green-100 text-green-800'\n    case 2:\n      return 'bg-red-100 text-red-800'\n    default:\n      return 'bg-gray-100 text-gray-800'\n  }\n}\n\nconst getStatusText = (docstatus) => {\n  switch (docstatus) {\n    case 0:\n      return 'Draft'\n    case 1:\n      return 'Submitted'\n    case 2:\n      return 'Cancelled'\n    default:\n      return 'Unknown'\n  }\n}\n\n// Watch for changes in scanned image to ensure proper preview\nwatch([scannedImageBlob, scannedImageUrl], () => {\n  console.log('Scanned image changed:', {\n    scannedImageBlob: !!scannedImageBlob.value,\n    scannedImageUrl: !!scannedImageUrl.value,\n    imagePreviewUrl: imagePreviewUrl.value,\n    canExtract: canExtract.value\n  })\n})\n\nonMounted(() => {\n  // ensure auth state already guarded by router; nothing additional for now\n})\n\nconst confirmAndSubmit = async () => {\n  if (!invoice.value || isProcessing.value) return\n\n  // Validate items first\n  const validationResult = await validateItems()\n  if (!validationResult?.all_valid) {\n    showMissingItemsDialog(validationResult?.missing_items || [])\n    return\n  }\n\n  // Duplicate warning\n  const dup = await checkForDuplicateInvoice(true)\n  if (dup?.isDuplicate) {\n    const proceedDup = window.confirm(\n      `A ${finalize.type} invoice already exists with the same details.\\n\\n` +\n      `Supplier: ${finalize.supplierName}\\n` +\n      `Invoice No: ${invoice.value.invoiceNumber}\\n` +\n      `Date: ${invoice.value.invoiceDate}\\n` +\n      `${dup.existingName ? `Existing: ${dup.existingName}\\n` : ''}` +\n      `Do you want to create it anyway?`\n    )\n    if (!proceedDup) return\n  }\n\n  const lines = [\n    `Type: ${finalize.type}`,\n    `Purchase Invoice Type: ${finalize.isReturn ? 'Credit Note (Return)' : 'Tax Invoice (Regular)'}`,\n    `Invoice No: ${invoice.value.invoiceNumber}`,\n    `Date: ${invoice.value.invoiceDate}`,\n    `Party: ${invoice.value.customerName}`,\n    `Items: ${invoice.value.items.length}`,\n    `Billed Actual Total: ${finalize.billAmount ?? ''}`,\n  ]\n  const ok = window.confirm(`Confirm create ${finalize.type} invoice?\\n\\n` + lines.join('\\n'))\n  if (!ok) return\n\n  await submitInvoice()\n}\n</script>\n\n<style scoped>\n/* Ensure table is responsive and scrollable */\n.overflow-x-auto {\n  scrollbar-width: thin;\n  scrollbar-color: #cbd5e0 #f7fafc;\n}\n\n.overflow-x-auto::-webkit-scrollbar {\n  height: 8px;\n}\n\n.overflow-x-auto::-webkit-scrollbar-track {\n  background: #f7fafc;\n  border-radius: 4px;\n}\n\n.overflow-x-auto::-webkit-scrollbar-thumb {\n  background: #cbd5e0;\n  border-radius: 4px;\n}\n\n.overflow-x-auto::-webkit-scrollbar-thumb:hover {\n  background: #a0aec0;\n}\n\n/* Ensure inputs don't overflow on small screens */\n@media (max-width: 640px) {\n  .w-16 {\n    width: 4rem;\n  }\n  \n  .w-20 {\n    width: 5rem;\n  }\n  \n  .w-32 {\n    width: 8rem;\n  }\n  \n  .w-48 {\n    width: 12rem;\n  }\n  \n  .w-80 {\n    width: 20rem;\n  }\n}\n\n/* Visual indicators for item status */\n.bg-red-50 {\n  background-color: #fef2f2;\n}\n\n.bg-green-50 {\n  background-color: #f0fdf4;\n}\n\n.border-red-500 {\n  border-color: #ef4444;\n}\n\n.border-green-500 {\n  border-color: #22c55e;\n}\n\n/* Add button styling */\n.add-button {\n  transition: all 0.2s ease-in-out;\n}\n\n.add-button:hover {\n  transform: scale(1.1);\n}\n\n/* Dialog animations */\n.fixed {\n  animation: fadeIn 0.2s ease-out;\n}\n\n@keyframes fadeIn {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n\n/* Drag and drop styling */\n.border-dashed {\n  transition: all 0.2s ease-in-out;\n}\n\n.border-dashed:hover {\n  border-color: #3b82f6;\n  background-color: #eff6ff;\n}\n\n.border-dashed.border-blue-400 {\n  border-color: #3b82f6;\n  background-color: #eff6ff;\n}\n\n/* Scanner button styling */\n.scanner-button {\n  transition: all 0.2s ease-in-out;\n}\n\n.scanner-button:hover:not(:disabled) {\n  transform: translateY(-1px);\n  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);\n}\n\n.scanner-button:disabled {\n  cursor: not-allowed;\n  opacity: 0.6;\n}\n\n/* Image preview styling */\n.image-preview {\n  transition: all 0.3s ease-in-out;\n}\n\n.image-preview:hover {\n  transform: scale(1.02);\n}\n\n/* Invoice type indication styling */\n.invoice-type-indication {\n  transition: all 0.2s ease-in-out;\n}\n\n.invoice-type-indication:hover {\n  transform: translateY(-1px);\n  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n}\n\n/* Checkbox styling */\ninput[type=\"checkbox\"] {\n  transition: all 0.2s ease-in-out;\n}\n\ninput[type=\"checkbox\"]:checked {\n  background-color: #3b82f6;\n  border-color: #3b82f6;\n}\n\ninput[type=\"checkbox\"]:focus {\n  outline: none;\n  ring: 2px;\n  ring-color: #3b82f6;\n  ring-offset: 2px;\n}\n\n/* Processing state styling */\n.processing-state {\n  pointer-events: none;\n  opacity: 0.7;\n}\n\n.processing-state button {\n  cursor: not-allowed;\n}\n</style>\n\n\n"],"names":["_createElementVNode","_toDisplayString","_unref","_createVNode","_vModelRadio","_vModelText","_normalizeClass","_openBlock","_createElementBlock","_createTextVNode","_createBlock","title","_vModelCheckbox","_Fragment","_vModelSelect","_renderList","invoice"],"mappings":"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"}