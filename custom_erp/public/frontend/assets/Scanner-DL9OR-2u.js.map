{"version":3,"file":"Scanner-DL9OR-2u.js","sources":["../../../../frontend/src/pages/Scanner.vue"],"sourcesContent":["<template>\n  <div class=\"min-h-screen bg-gray-50\">\n    <div class=\"bg-white shadow-sm border-b border-gray-200 sticky top-0 z-20\">\n      <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n        <div class=\"flex justify-between items-center py-6\">\n          <div>\n            <h1 class=\"text-2xl font-bold text-gray-900\">Invoice Scanner</h1>\n            <p class=\"text-sm text-gray-600\">Authenticated as {{ session.user }}</p>\n          </div>\n          <Button @click=\"session.logout.submit()\" theme=\"gray\" variant=\"outline\">Logout</Button>\n        </div>\n      </div>\n    </div>\n\n    <div class=\"max-w-7xl mx-auto px-3 sm:px-4 lg:px-6 py-4 sm:py-8\">\n      <div class=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-8\">\n        <h2 class=\"text-lg font-semibold text-gray-900 mb-4\">Invoice Image Input</h2>\n        \n        <!-- Invoice Type Selection -->\n        <div class=\"mb-4\">\n          <label class=\"block text-sm text-gray-700 mb-2\">Invoice Type</label>\n          <div class=\"flex gap-4\">\n            <label class=\"flex items-center gap-2\">\n              <input type=\"radio\" value=\"purchase\" v-model=\"finalize.type\" /> Purchase\n            </label>\n            <label class=\"flex items-center gap-2\">\n              <input type=\"radio\" value=\"sales\" v-model=\"finalize.type\" /> Sales\n            </label>\n          </div>\n        </div>\n        \n        <!-- Scanner Configuration -->\n        <div class=\"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4\">\n          <div>\n            <label class=\"block text-sm font-medium text-gray-700 mb-2\">Connection URL</label>\n            <input type=\"text\" \n                   v-model=\"scannerConfig.connectionUrl\" \n                   class=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                   placeholder=\"http://localhost:17890\" />\n          </div>\n          <div>\n            <label class=\"block text-sm font-medium text-gray-700 mb-2\">DPI</label>\n            <input type=\"number\" \n                   v-model.number=\"scannerConfig.dpi\" \n                   min=\"100\" max=\"600\" step=\"50\"\n                   class=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                   placeholder=\"300\" />\n          </div>\n        </div>\n        \n        <!-- Main Image Input Area -->\n        <div class=\"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-blue-400 transition-colors\"\n             @drop=\"onDrop\"\n             @dragover.prevent\n             @dragenter=\"() => isDragOver = true\"\n             @dragleave=\"onDragLeave\"\n             :class=\"{'border-blue-400 bg-blue-50': isDragOver}\">\n          \n          <!-- Image Preview -->\n          <div v-if=\"selectedFile || capturedDataUrl || scannedImageBlob || scannedImageUrl\" class=\"mb-4\">\n            <img v-if=\"imagePreviewUrl\" \n                 :src=\"imagePreviewUrl\" \n                 alt=\"Invoice Preview\" \n                 class=\"max-w-full h-auto max-h-64 mx-auto rounded-lg shadow-md\" />\n            <div class=\"mt-2 flex justify-center space-x-2\">\n              <button @click=\"clearImage\" \n                      class=\"px-3 py-1 text-sm text-red-600 hover:text-red-800 hover:bg-red-50 rounded\">\n                Remove Image\n              </button>\n            </div>\n          </div>\n          \n          <!-- Upload Options -->\n          <div v-if=\"!selectedFile && !capturedDataUrl && !scannedImageBlob && !scannedImageUrl\" class=\"space-y-4\">\n            <div class=\"flex flex-col sm:flex-row gap-3 justify-center\">\n              <!-- File Upload -->\n              <label class=\"flex-1 cursor-pointer\">\n                <input type=\"file\" \n                       @change=\"onFileSelected\" \n                       accept=\"image/*\" \n                       class=\"hidden\" />\n                <div class=\"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors text-center\">\n                  üìÅ Upload from Local Storage\n                </div>\n              </label>\n              \n              <!-- Scanner -->\n              <button @click=\"scan\" \n                      :disabled=\"scanning\"\n                      class=\"flex-1 px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors\">\n                <span v-if=\"scanning\">üîÑ Scanning...</span>\n                <span v-else>üì∑ Scan Document</span>\n              </button>\n            </div>\n            \n            <!-- Drag & Drop Instructions -->\n            <div class=\"text-gray-500 text-sm\">\n              <p>Or drag and drop an image file here</p>\n              <p class=\"text-xs mt-1\">Supports: JPG, PNG, WebP</p>\n            </div>\n          </div>\n        </div>\n\n        <div class=\"mt-6 flex gap-3\">\n          <Button theme=\"blue\" :loading=\"extracting\" @click=\"extractInvoice\" :disabled=\"!canExtract\">Extract Invoice</Button>\n          <Button theme=\"gray\" variant=\"outline\" @click=\"showLastInvoices\" :loading=\"loadingLastInvoices\">\n            View Last 3 {{ finalize.type === 'purchase' ? 'Purchase' : 'Sales' }} Invoices\n          </Button>\n          <Alert v-if=\"extractError\" theme=\"red\">{{ extractError }}</Alert>\n        </div>\n      </div>\n\n      <div v-if=\"invoice\" class=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-8\">\n        <h2 class=\"text-lg font-semibold text-gray-900 mb-4\">Extracted Data</h2>\n        \n        <!-- Invoice Type Indication -->\n        <div v-if=\"invoiceType\" class=\"mb-4 p-3 rounded-md\" \n             :class=\"invoiceType === 'credit_note' ? 'bg-orange-50 border border-orange-200' : 'bg-blue-50 border border-blue-200'\">\n          <div class=\"flex items-center\">\n            <div v-if=\"invoiceType === 'credit_note'\" class=\"flex-shrink-0 w-5 h-5 text-orange-400\">\n              ‚Ü∂\n            </div>\n            <div v-else class=\"flex-shrink-0 w-5 h-5 text-blue-400\">\n              üìÑ\n            </div>\n            <div class=\"ml-3\">\n              <p class=\"text-sm font-medium\" \n                 :class=\"invoiceType === 'credit_note' ? 'text-orange-800' : 'text-blue-800'\">\n                {{ invoiceType === 'credit_note' ? 'Credit Note (Return)' : 'Tax Invoice (Regular)' }}\n              </p>\n              <p class=\"text-sm\" \n                 :class=\"invoiceType === 'credit_note' ? 'text-orange-700' : 'text-blue-700'\">\n                {{ invoiceType === 'credit_note' ? 'This is a return/credit note. Will be processed as a return transaction.' : 'This is a regular tax invoice.' }}\n              </p>\n              <p class=\"text-xs mt-1 text-gray-600\">\n                {{ detectionMethod === 'title' ? `Detected from document title: \"${title}\"` : 'Inferred from document content' }}\n              </p>\n            </div>\n          </div>\n        </div>\n        \n        <div class=\"grid grid-cols-1 md:grid-cols-3 gap-3 sm:gap-4\">\n          <div>\n            <label class=\"block text-sm text-gray-600 mb-1\">Invoice Number</label>\n            <input v-model=\"invoice.invoiceNumber\" class=\"w-full px-3 py-2 border rounded\" placeholder=\"INV-001\" />\n          </div>\n          <div>\n            <label class=\"block text-sm text-gray-600 mb-1\">Invoice Date</label>\n            <input v-model=\"invoice.invoiceDate\" type=\"date\" class=\"w-full px-3 py-2 border rounded\" />\n          </div>\n          <div>\n            <label class=\"block text-sm text-gray-600 mb-1\">Supplier</label>\n            <input v-model=\"finalize.supplierName\" class=\"w-full px-3 py-2 border rounded\" placeholder=\"bntl\" />\n          </div>\n        </div>\n\n        <!-- Invoice Type moved above to enforce selection before extraction -->\n\n        <div class=\"mt-4 grid md:grid-cols-3 gap-3 sm:gap-4\">\n          <div>\n            <label class=\"block text-sm text-gray-700 mb-2\">Bill Actual Amount</label>\n            <input type=\"number\" step=\"0.01\" class=\"w-full px-3 py-2 border rounded\" v-model.number=\"finalize.billAmount\" />\n          </div>\n          <div>\n            <label class=\"block text-sm text-gray-700 mb-2\">Purchase Invoice Type</label>\n            <div class=\"flex items-center mt-2\">\n              <input type=\"checkbox\" \n                     v-model=\"finalize.isReturn\" \n                     class=\"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 focus:ring-2\" />\n              <label class=\"ml-2 text-sm text-gray-700\">Mark as Credit Note (Return)</label>\n            </div>\n            <p class=\"text-xs text-gray-500 mt-1\">\n              When checked, will be processed as a return transaction. \n              {{ detectionMethod === 'title' ? 'Auto-detected from document title.' : 'Auto-detected from document content. Please verify.' }}\n            </p>\n            <p v-if=\"detectionMethod === 'inferred'\" class=\"text-xs text-orange-600 mt-1\">\n              ‚ö†Ô∏è Detection was inferred. Please verify the invoice type is correct.\n            </p>\n          </div>\n          <div class=\"md:col-span-2\">\n            <label class=\"block text-sm text-gray-700 mb-2\">Attach Final Photo</label>\n            <div class=\"border-2 border-dashed border-gray-300 rounded-lg p-4 text-center hover:border-blue-400 transition-colors\"\n                 @drop=\"onFinalPhotoDrop\"\n                 @dragover.prevent\n                 @dragenter=\"() => isFinalPhotoDragOver = true\"\n                 @dragleave=\"onFinalPhotoDragLeave\"\n                 :class=\"{'border-blue-400 bg-blue-50': isFinalPhotoDragOver}\">\n              \n              <!-- Final Photo Preview -->\n              <div v-if=\"finalize.finalPhotoFile\" class=\"mb-4\">\n                <img v-if=\"finalPhotoPreviewUrl\" \n                     :src=\"finalPhotoPreviewUrl\" \n                     alt=\"Final Photo Preview\" \n                     class=\"max-w-full h-auto max-h-32 mx-auto rounded-lg shadow-md\" />\n                <div class=\"mt-2 flex justify-center space-x-2\">\n                  <button @click=\"clearFinalPhoto\" \n                          class=\"px-3 py-1 text-sm text-red-600 hover:text-red-800 hover:bg-red-50 rounded\">\n                    Remove Photo\n                  </button>\n                </div>\n              </div>\n              \n              <!-- Final Photo Upload Options -->\n              <div v-if=\"!finalize.finalPhotoFile\" class=\"space-y-4\">\n                <div class=\"flex flex-col sm:flex-row gap-3 justify-center\">\n                  <!-- File Upload -->\n                  <label class=\"flex-1 cursor-pointer\">\n                    <input type=\"file\" \n                           @change=\"onFinalPhotoSelected\" \n                           accept=\"image/*\" \n                           class=\"hidden\" />\n                    <div class=\"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors text-center text-sm\">\n                      üìÅ Upload Photo\n                    </div>\n                  </label>\n                  \n                  <!-- Scanner -->\n                  <button @click=\"scanFinalPhoto\" \n                          :disabled=\"scanning\"\n                          class=\"flex-1 px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors text-sm\">\n                    <span v-if=\"scanning\">üîÑ Scanning...</span>\n                    <span v-else>üì∑ Scan Photo</span>\n                  </button>\n                </div>\n                \n                <!-- Drag & Drop Instructions -->\n                <div class=\"text-gray-500 text-xs\">\n                  <p>Or drag and drop a photo file here</p>\n                </div>\n              </div>\n            </div>\n          </div>\n          <div class=\"md:col-span-3\">\n            <label class=\"block text-sm text-gray-700 mb-2\">Discount (Rs)</label>\n            <input type=\"number\" step=\"0.01\" class=\"w-full px-3 py-2 border rounded\" v-model.number=\"invoice.totalDiscountAmount\" />\n          </div>\n        </div>\n\n        <div v-if=\"finalize.type==='purchase'\" class=\"mt-6\">\n          <div class=\"flex justify-between items-center mb-4\">\n            <h3 class=\"font-semibold\">Leakages & Bursts (per item)</h3>\n            <div v-if=\"deletedRows.length > 0\" class=\"flex items-center gap-2\">\n              <Button theme=\"blue\" variant=\"outline\" size=\"sm\" @click=\"undoLastDelete\" class=\"hover:bg-blue-50\">\n                <span class=\"mr-1 text-blue-600\">‚Ü∂</span> Undo Delete ({{ deletedRows.length }})\n              </Button>\n            </div>\n          </div>\n          \n          <!-- Validation Status Summary -->\n          <div v-if=\"itemValidation\" class=\"mb-4 p-3 rounded-md\" \n               :class=\"itemValidation.all_valid ? 'bg-green-50 border border-green-200' : 'bg-yellow-50 border border-yellow-200'\">\n            <div class=\"flex items-center justify-between\">\n              <div class=\"flex items-center\">\n                <div v-if=\"itemValidation.all_valid\" class=\"flex-shrink-0 w-5 h-5 text-green-400\">\n                  ‚úì\n                </div>\n                <div v-else class=\"flex-shrink-0 w-5 h-5 text-yellow-400\">\n                  ‚ö†\n                </div>\n                <div class=\"ml-3\">\n                  <p class=\"text-sm font-medium\" \n                     :class=\"itemValidation.all_valid ? 'text-green-800' : 'text-yellow-800'\">\n                    {{ itemValidation.all_valid ? 'All items are valid' : `${itemValidation.missing_items.length} items need to be added to master data` }}\n                  </p>\n                  <p v-if=\"!itemValidation.all_valid\" class=\"text-sm text-yellow-700 mt-1\">\n                    Use the \"+\" button next to missing items to add them to the master data. After adding items, click \"Re-validate Items\" to check again.\n                  </p>\n                </div>\n              </div>\n              <div class=\"flex space-x-2\">\n                <Button theme=\"blue\" variant=\"outline\" size=\"sm\" @click=\"validateItems\">\n                  Re-validate Items\n                </Button>\n                <Button theme=\"gray\" variant=\"outline\" size=\"sm\" @click=\"resetItemStatuses\">\n                  Reset Statuses\n                </Button>\n              </div>\n            </div>\n          </div>\n          \n          <!-- Manual Validation Button (when no validation status) -->\n          <div v-else-if=\"invoice?.items?.length > 0\" class=\"mb-4 p-3 rounded-md bg-gray-50 border border-gray-200\">\n            <div class=\"flex items-center justify-between\">\n              <div class=\"flex items-center\">\n                <div class=\"flex-shrink-0 w-5 h-5 text-gray-400\">\n                  ‚Ñπ\n                </div>\n                <div class=\"ml-3\">\n                  <p class=\"text-sm font-medium text-gray-800\">\n                    Validate items before creating invoice\n                  </p>\n                  <p class=\"text-sm text-gray-600 mt-1\">\n                    Click the button to check if all items exist in master data. Validation only runs when you click this button or the \"Create Invoice\" button.\n                  </p>\n                </div>\n              </div>\n              <Button theme=\"blue\" variant=\"outline\" size=\"sm\" @click=\"validateItems\" class=\"ml-4\">\n                Validate Items\n              </Button>\n            </div>\n          </div>\n          \n          <div class=\"overflow-x-auto border border-gray-200 rounded-lg\">\n            <table class=\"min-w-full divide-y divide-gray-200\">\n              <thead class=\"bg-gray-50\">\n                <tr>\n                  <th class=\"px-2 sm:px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-32 sm:w-48\">Code</th>\n                  <th class=\"px-2 sm:px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-48 sm:w-80\">Description</th>\n                  <th class=\"px-2 sm:px-3 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider w-20 sm:w-24\">Qty</th>\n                  <th class=\"px-2 sm:px-3 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider w-20 sm:w-24\">UOM</th>\n                  <th class=\"px-2 sm:px-3 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider w-20 sm:w-24\">Leakages</th>\n                  <th class=\"px-2 sm:px-3 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider w-20 sm:w-24\">Bursts</th>\n                  <th class=\"px-2 sm:px-3 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider w-16\">Actions</th>\n                </tr>\n              </thead>\n              <tbody class=\"bg-white divide-y divide-gray-200\">\n                <tr v-for=\"(it, idx) in invoice.items\" :key=\"idx\" \n                    :class=\"{'hover:bg-gray-50': true, 'bg-red-50': it.isMissing, 'bg-green-50': it.itemCreated}\">\n                  <td class=\"px-2 sm:px-3 py-3 text-sm\">\n                    <div class=\"flex items-center space-x-2\">\n                      <input class=\"w-full px-2 sm:px-3 py-2 border rounded text-sm\" \n                             v-model=\"it.materialCode\" \n                             :class=\"{'border-red-500': it.isMissing, 'border-green-500': it.itemCreated}\"\n                             placeholder=\"Item Code\" />\n                      <!-- Add button for missing items -->\n                      <button v-if=\"it.isMissing && !it.itemCreated\"\n                              @click=\"openNewItemDialog(idx)\"\n                              class=\"flex-shrink-0 w-8 h-8 bg-blue-500 hover:bg-blue-600 text-white rounded-full flex items-center justify-center text-lg font-bold transition-colors add-button\">\n                        +\n                      </button>\n                      <!-- Success checkmark for created items -->\n                      <span v-if=\"it.itemCreated\" class=\"flex-shrink-0 w-8 h-8 bg-green-500 text-white rounded-full flex items-center justify-center text-sm\">\n                        ‚úì\n                      </span>\n                    </div>\n                  </td>\n                  <td class=\"px-2 sm:px-3 py-3 text-sm\">\n                    <input class=\"w-full px-2 sm:px-3 py-2 border rounded text-sm\" \n                           v-model=\"it.materialDescription\" \n                           placeholder=\"Description\" />\n                  </td>\n                  <td class=\"px-2 sm:px-3 py-3 text-sm text-center\">\n                    <input type=\"number\" class=\"w-16 sm:w-20 px-2 sm:px-3 py-2 border rounded text-center\" \n                           v-model.number=\"it.salesQty\" inputmode=\"numeric\" />\n                  </td>\n                  <td class=\"px-2 sm:px-3 py-3 text-sm text-center\">\n                    <select v-model=\"it.uom\" class=\"px-2 sm:px-3 py-2 border rounded text-center w-16 sm:w-20\">\n                      <option value=\"CS\">CS</option>\n                      <option value=\"Nos\">Nos</option>\n                    </select>\n                  </td>\n                  <td class=\"px-2 sm:px-3 py-3 text-sm text-center\">\n                    <input type=\"number\" min=\"0\" class=\"w-16 sm:w-20 px-2 sm:px-3 py-2 border rounded text-center\" \n                           v-model.number=\"finalize.items[idx].leakages\" inputmode=\"numeric\" />\n                  </td>\n                  <td class=\"px-2 sm:px-3 py-3 text-center\">\n                    <input type=\"number\" min=\"0\" class=\"w-16 sm:w-20 px-2 sm:px-3 py-2 border rounded text-center\" \n                           v-model.number=\"finalize.items[idx].bursts\" inputmode=\"numeric\" />\n                  </td>\n                  <td class=\"px-2 sm:px-3 py-3 text-sm text-center\">\n                    <Button theme=\"red\" variant=\"outline\" size=\"sm\" @click=\"deleteRow(idx)\" class=\"text-red-600 hover:text-red-700\">\n                      <span class=\"text-xs\">üóëÔ∏è</span>\n                    </Button>\n                  </td>\n                </tr>\n              </tbody>\n            </table>\n          </div>\n        </div>\n\n        <div class=\"mt-6 flex justify-end\">\n          <Button theme=\"green\" \n                  :loading=\"submitting || isProcessing\" \n                  :disabled=\"!finalize.type || isProcessing\" \n                  @click=\"confirmAndSubmit\">\n            {{ isProcessing ? 'Processing...' : `Create ${finalize.type==='purchase' ? 'Purchase' : 'Sales'} Invoice` }}\n          </Button>\n        </div>\n      </div>\n    </div>\n  </div>\n  \n  <!-- New Item Creation Dialog -->\n  <div v-if=\"showNewItemDialog\" class=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n    <div class=\"bg-white rounded-lg shadow-xl max-w-md w-full max-h-[90vh] overflow-y-auto\">\n      <div class=\"px-6 py-4 border-b border-gray-200\">\n        <h3 class=\"text-lg font-medium text-gray-900\">Create New Item</h3>\n        <p class=\"text-sm text-gray-500 mt-1\">Add this item to the master data</p>\n      </div>\n      \n      <div class=\"px-6 py-4 space-y-4\">\n        <!-- Item Code -->\n        <div>\n          <label class=\"block text-sm font-medium text-gray-700 mb-1\">Item Code *</label>\n          <input type=\"text\" \n                 v-model=\"newItemData.item_code\" \n                 class=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                 placeholder=\"Enter item code\" />\n        </div>\n        \n        <!-- Item Name -->\n        <div>\n          <label class=\"block text-sm font-medium text-gray-700 mb-1\">Item Name *</label>\n          <input type=\"text\" \n                 v-model=\"newItemData.item_name\" \n                 class=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                 placeholder=\"Enter item name\" />\n        </div>\n        \n        <!-- Selling Price -->\n        <div>\n          <label class=\"block text-sm font-medium text-gray-700 mb-1\">Selling Price</label>\n          <input type=\"number\" \n                 v-model.number=\"newItemData.selling_price\" \n                 step=\"0.01\" min=\"0\"\n                 class=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                 placeholder=\"0.00\" />\n        </div>\n        \n        <!-- Valuation Price -->\n        <div>\n          <label class=\"block text-sm font-medium text-gray-700 mb-1\">Valuation Price *</label>\n          <input type=\"number\" \n                 v-model.number=\"newItemData.valuation_price\" \n                 step=\"0.01\" min=\"0\"\n                 class=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500\"\n                 placeholder=\"0.00\" />\n        </div>\n        \n        <!-- UOM Conversion -->\n        <div>\n          <label class=\"block text-sm font-medium text-gray-700 mb-1\">Nos in CS (UOM Conversion)</label>\n          <input type=\"number\" \n                 v-model.number=\"newItemData.uom_conversion\" \n                 min=\"1\" step=\"1\"\n                 class=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                 placeholder=\"6\" />\n          <p class=\"text-xs text-gray-500 mt-1\">How many Nos (pieces) are in 1 CS (Case)</p>\n        </div>\n      </div>\n      \n      <div class=\"px-6 py-4 border-t border-gray-200 flex justify-end space-x-3\">\n        <button @click=\"showNewItemDialog = false\" \n                class=\"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md transition-colors\">\n          Cancel\n        </button>\n        <button @click=\"createNewItem\" \n                class=\"px-4 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 rounded-md transition-colors\">\n          Create Item\n        </button>\n      </div>\n    </div>\n  </div>\n\n  <!-- Last Invoices Dialog -->\n  <div v-if=\"showLastInvoicesDialog\" class=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n    <div class=\"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto\">\n      <div class=\"px-6 py-4 border-b border-gray-200\">\n        <h3 class=\"text-lg font-medium text-gray-900\">Last 3 {{ finalize.type === 'purchase' ? 'Purchase' : 'Sales' }} Invoices</h3>\n        <p class=\"text-sm text-gray-500 mt-1\">Showing the most recent invoices by posting date</p>\n      </div>\n      \n      <div class=\"px-6 py-4\">\n        <div v-if=\"loadingLastInvoices\" class=\"flex justify-center items-center py-8\">\n          <div class=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600\"></div>\n          <span class=\"ml-3 text-gray-600\">Loading invoices...</span>\n        </div>\n        \n        <div v-else-if=\"lastInvoices.length === 0\" class=\"text-center py-8\">\n          <div class=\"text-gray-400 text-6xl mb-4\">üìÑ</div>\n          <p class=\"text-gray-600\">No {{ finalize.type === 'purchase' ? 'purchase' : 'sales' }} invoices found</p>\n        </div>\n        \n        <div v-else class=\"space-y-4\">\n          <div v-for=\"invoice in lastInvoices\" :key=\"invoice.name\" \n               class=\"border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-colors\">\n            <div class=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n              <div>\n                <label class=\"block text-sm font-medium text-gray-700 mb-1\">Invoice Name</label>\n                <p class=\"text-sm text-gray-900 font-mono\">{{ invoice.name }}</p>\n              </div>\n              <div>\n                <label class=\"block text-sm font-medium text-gray-700 mb-1\">Posting Date</label>\n                <p class=\"text-sm text-gray-900\">{{ formatDate(invoice.posting_date) }}</p>\n              </div>\n              <div>\n                <label class=\"block text-sm font-medium text-gray-700 mb-1\">Amount</label>\n                <p class=\"text-sm text-gray-900 font-semibold\">‚Çπ{{ formatAmount(invoice.grand_total) }}</p>\n              </div>\n              <div>\n                <label class=\"block text-sm font-medium text-gray-700 mb-1\">Status</label>\n                <span class=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium\"\n                      :class=\"getStatusClass(invoice.docstatus)\">\n                  {{ getStatusText(invoice.docstatus) }}\n                </span>\n              </div>\n            </div>\n            <div v-if=\"finalize.type === 'purchase' && invoice.bill_no\" class=\"mt-3 pt-3 border-t border-gray-100\">\n              <div>\n                <label class=\"block text-xs font-medium text-gray-500 mb-1\">Supplier Invoice No</label>\n                <p class=\"text-sm text-gray-900\">{{ invoice.bill_no }}</p>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n      \n      <div class=\"px-6 py-4 border-t border-gray-200 flex justify-end\">\n        <button @click=\"showLastInvoicesDialog = false\" \n                class=\"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md transition-colors\">\n          Close\n        </button>\n      </div>\n    </div>\n  </div>\n  \n</template>\n\n<script setup>\nimport { ref, reactive, onMounted, watch, computed } from 'vue'\nimport { createResource } from 'frappe-ui'\nimport { session } from '@/data/session'\n\nconst selectedFile = ref(null)\nconst selectedFileName = ref('')\nconst capturedDataUrl = ref('')\nconst extractError = ref('')\nconst extracting = ref(false)\nconst invoice = ref(null)\nconst submitting = ref(false)\n\n// Scanner configuration\nconst scannerConfig = reactive({\n  connectionUrl: 'http://localhost:17890',\n  dpi: 300\n})\n\n// Drag and drop states\nconst isDragOver = ref(false)\nconst isFinalPhotoDragOver = ref(false)\n\n// Scanner states\nconst scanning = ref(false)\nconst scannedImageBlob = ref(null)\nconst scannedImageUrl = ref('')\n\n// Optimized image preview URL management\nconst imagePreviewUrl = computed(() => {\n  if (selectedFile.value) return URL.createObjectURL(selectedFile.value)\n  if (capturedDataUrl.value) return capturedDataUrl.value\n  if (scannedImageBlob.value) return URL.createObjectURL(scannedImageBlob.value)\n  if (scannedImageUrl.value) return scannedImageUrl.value\n  return null\n})\n\nconst finalPhotoPreviewUrl = computed(() => {\n  if (finalize.finalPhotoFile) return URL.createObjectURL(finalize.finalPhotoFile)\n  return null\n})\n\nconst finalize = reactive({\n  type: 'purchase', // default purchase\n  billAmount: null,\n  finalPhotoFile: null,\n  supplierName: 'bntl',\n  items: [],\n  isReturn: false, // New field for return/credit note\n})\n\n// Track deleted rows for undo functionality\nconst deletedRows = ref([])\n\n// Item validation and new item creation\nconst itemValidation = ref(null)\nconst showNewItemDialog = ref(false)\nconst newItemData = reactive({\n  item_code: '',\n  item_name: '',\n  selling_price: 0,\n  valuation_price: 0,\n  uom_conversion: 6, // Default CS = 6 Nos\n  rowIndex: -1\n})\n\n// Add invoice type detection\nconst invoiceType = ref('') // 'tax_invoice' or 'credit_note'\nconst isProcessing = ref(false) // Prevent multiple submissions\nconst detectionMethod = ref('') // 'title' or 'inferred'\n\n// Last invoices functionality\nconst showLastInvoicesDialog = ref(false)\nconst loadingLastInvoices = ref(false)\nconst lastInvoices = ref([])\n\n// Camera variables removed - replaced with scanner functionality\n\nconst onFileSelected = (e) => {\n  const f = e?.target?.files?.[0]\n  if (!f) return\n  selectedFile.value = f\n  selectedFileName.value = f.name\n  capturedDataUrl.value = ''\n}\n\nconst onFinalPhotoSelected = (e) => {\n  const f = e?.target?.files?.[0]\n  if (f) finalize.finalPhotoFile = f\n}\n\n// Drag and drop functions\nconst onDrop = (e) => {\n  e.preventDefault()\n  isDragOver.value = false\n  \n  const files = Array.from(e.dataTransfer.files)\n  const imageFile = files.find(file => file.type.startsWith('image/'))\n  \n  if (imageFile) {\n    selectedFile.value = imageFile\n    selectedFileName.value = imageFile.name\n    capturedDataUrl.value = ''\n    scannedImageBlob.value = null\n    scannedImageUrl.value = ''\n  }\n}\n\nconst onDragLeave = () => {\n  isDragOver.value = false\n}\n\nconst onFinalPhotoDrop = (e) => {\n  e.preventDefault()\n  isFinalPhotoDragOver.value = false\n  \n  const files = Array.from(e.dataTransfer.files)\n  const imageFile = files.find(file => file.type.startsWith('image/'))\n  \n  if (imageFile) {\n    finalize.finalPhotoFile = imageFile\n  }\n}\n\nconst onFinalPhotoDragLeave = () => {\n  isFinalPhotoDragOver.value = false\n}\n\n// Scanner functions\nconst scan = async () => {\n  try {\n    scanning.value = true;\n\n    // Trigger scan\n    const res = await fetch(`${scannerConfig.connectionUrl}/scan`, {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({\n        dpi: scannerConfig.dpi,\n        mode: 'Color'\n      })\n    });\n\n    if (!res.ok) {\n      const error = await res.text()\n      throw new Error(`Scan failed: ${error}`)\n    }\n\n    const { data, format } = await res.json();\n\n    const byteArray = Uint8Array.from(atob(data), c => c.charCodeAt(0));\n    const imageBlob = new Blob([byteArray], { type: `image/${format}` });\n    \n    // Set scanned image as the active source\n    scannedImageBlob.value = imageBlob;\n    scannedImageUrl.value = URL.createObjectURL(imageBlob);\n    \n    // Debug logging\n    console.log('Scan completed:', {\n      scannedImageBlob: !!scannedImageBlob.value,\n      scannedImageUrl: !!scannedImageUrl.value,\n      imagePreviewUrl: imagePreviewUrl.value,\n      canExtract: canExtract.value\n    });\n    \n    // Clear other image sources to avoid confusion\n    selectedFile.value = null;\n    selectedFileName.value = '';\n    capturedDataUrl.value = '';\n\n    alert('Document scanned successfully!');\n  } catch (err) {\n    alert('Scan failed: ' + err.message);\n  } finally {\n    scanning.value = false;\n  }\n}\n\nconst scanFinalPhoto = async () => {\n  try {\n    scanning.value = true;\n\n    // Trigger scan\n    const res = await fetch(`${scannerConfig.connectionUrl}/scan`, {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({\n        dpi: scannerConfig.dpi,\n        mode: 'Color'\n      })\n    });\n\n    if (!res.ok) {\n      const error = await res.text()\n      throw new Error(`Scan failed: ${error}`)\n    }\n\n    const { data, format } = await res.json();\n\n    const byteArray = Uint8Array.from(atob(data), c => c.charCodeAt(0));\n    const imageBlob = new Blob([byteArray], { type: `image/${format}` });\n\n    // Correctly update finalize.finalPhotoFile for the attachment preview\n    finalize.finalPhotoFile = new File([imageBlob], `scanned_photo.${format}`, { type: `image/${format}` });\n\n    alert('Photo scanned successfully!');\n  } catch (err) {\n    alert('Scan failed: ' + err.message);\n  } finally {\n    scanning.value = false;\n  }\n}\n\n// Enhanced image cleanup function\nconst clearImage = () => {\n  // Revoke object URLs to prevent memory leaks\n  if (scannedImageUrl.value) {\n    URL.revokeObjectURL(scannedImageUrl.value)\n  }\n  \n  // Clear all image references\n  selectedFile.value = null\n  selectedFileName.value = ''\n  capturedDataUrl.value = ''\n  scannedImageBlob.value = null\n  scannedImageUrl.value = ''\n  \n  // Force garbage collection if available\n  if (window.gc) {\n    window.gc()\n  }\n}\n\nconst clearFinalPhoto = () => {\n  if (finalize.finalPhotoFile) {\n    finalize.finalPhotoFile = null\n  }\n  \n  // Force garbage collection if available\n  if (window.gc) {\n    window.gc()\n  }\n}\n\n// Camera functions removed - replaced with scanner functionality\n\nconst canExtract = computed(() => {\n  return !!selectedFile.value || !!capturedDataUrl.value || !!scannedImageBlob.value || !!scannedImageUrl.value\n})\n\nconst safeJson = async (res) => {\n  try {\n    const text = await res.text()\n    if (!text) return {}\n    try { return JSON.parse(text) } catch (_) {}\n    // try strip code fences or trailing commas\n    const cleaned = text.trim().replace(/^```(?:json)?/i, '').replace(/```$/, '')\n    return JSON.parse(cleaned)\n  } catch (e) { return {} }\n}\n\n// Memory management utilities\nconst memoryMonitor = {\n  checkMemoryUsage: () => {\n    if ('memory' in performance) {\n      const memory = performance.memory\n      const usedMB = Math.round(memory.usedJSHeapSize / 1024 / 1024)\n      const totalMB = Math.round(memory.totalJSHeapSize / 1024 / 1024)\n      const limitMB = Math.round(memory.jsHeapSizeLimit / 1024 / 1024)\n      \n      console.log(`Memory Usage: ${usedMB}MB / ${totalMB}MB (${limitMB}MB limit)`)\n      \n      // Warn if memory usage is high\n      if (usedMB > limitMB * 0.8) {\n        console.warn('High memory usage detected! Consider clearing some data.')\n        return false\n      }\n      return true\n    }\n    return true\n  },\n  \n  forceCleanup: () => {\n    // Clear any cached data\n    if (window.gc) {\n      window.gc()\n    }\n    \n    // Clear any stored data that might be taking up memory\n    try {\n      localStorage.clear()\n      sessionStorage.clear()\n    } catch (e) {\n      console.warn('Could not clear storage:', e)\n    }\n  }\n}\n\n// Enhanced robust fetch with memory monitoring\nconst robustFetch = async (url, opts = {}) => {\n  const maxRetries = 2\n  const retryDelays = [500, 1000]\n  \n  for (let attempt = 0; attempt <= maxRetries; attempt++) {\n    try {\n      // Check memory before making request\n      if (!memoryMonitor.checkMemoryUsage()) {\n        memoryMonitor.forceCleanup()\n      }\n      \n      const controller = new AbortController()\n      const timeout = setTimeout(() => controller.abort(), 30000)\n      const res = await fetch(url, { ...opts, signal: controller.signal })\n      clearTimeout(timeout)\n      \n      // Retry on transient gateways\n      if ([502, 503, 504].includes(res.status) && attempt < maxRetries) {\n        await new Promise(r => setTimeout(r, retryDelays[attempt]))\n        continue\n      }\n      return res\n    } catch (e) {\n      if (attempt < maxRetries) {\n        await new Promise(r => setTimeout(r, retryDelays[attempt]))\n        continue\n      }\n      throw new Error(e?.name === 'AbortError' ? 'Request timed out. Please try again.' : (e?.message || 'Network error'))\n    }\n  }\n}\n\nconst extractInvoice = async () => {\n  extractError.value = ''\n  extracting.value = true\n  invoice.value = null\n  invoiceType.value = '' // Reset invoice type\n  finalize.isReturn = false // Reset return flag\n  detectionMethod.value = '' // Reset detection method\n  try {\n    if (!finalize.type) throw new Error('Select invoice type first')\n    let res\n    if (selectedFile.value) {\n      const b64 = await toBase64(selectedFile.value)\n      res = await robustFetch('/api/method/custom_erp.custom_erp.purchase_invoice.api.extract_invoice', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ image_data: b64 })\n      })\n    } else if (capturedDataUrl.value) {\n      res = await robustFetch('/api/method/custom_erp.custom_erp.purchase_invoice.api.extract_invoice', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ image_data: capturedDataUrl.value })\n      })\n    } else if (scannedImageBlob.value) {\n      const b64 = await toBase64(scannedImageBlob.value)\n      res = await robustFetch('/api/method/custom_erp.custom_erp.purchase_invoice.api.extract_invoice', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ image_data: b64 })\n      })\n    } else {\n      throw new Error('No input')\n    }\n    const data = await safeJson(res)\n    const msg = data.message || data\n    if (!res.ok || !msg?.success) throw new Error(msg?.error || 'Extraction failed')\n    \n    // Debug: Log the full response\n    console.log('Full extraction response:', msg)\n    console.log('Extracted data:', msg.data)\n    \n    // Detect purchase invoice type from the extracted title\n    const title = msg.data?.title || ''\n    console.log('Extracted title:', title) // Debug log\n    \n    // Try to detect from title first\n    let detectedType = null\n    let method = 'inferred'\n    \n    if (title.toLowerCase().includes('credit note')) {\n      detectedType = 'credit_note'\n      method = 'title'\n      console.log('Detected Credit Note from title')\n    } else if (title.toLowerCase().includes('tax invoice')) {\n      detectedType = 'tax_invoice'\n      method = 'title'\n      console.log('Detected Tax Invoice from title')\n    }\n    \n    // If title detection failed, try to infer from other fields\n    if (!detectedType) {\n      console.log('Title detection failed, trying to infer from other fields...')\n      // Check if there are any negative amounts that might indicate a credit note\n      // Note: We don't check for negative quantities anymore since we always make them positive\n      const hasNegativeValues = msg.data?.items?.some(item => \n        (item.lineTotal && item.lineTotal < 0)\n      )\n      \n      if (hasNegativeValues) {\n        detectedType = 'credit_note'\n        method = 'inferred'\n        console.log('Inferred Credit Note from negative line totals')\n      } else {\n        detectedType = 'tax_invoice'\n        method = 'inferred'\n        console.log('Defaulting to Tax Invoice')\n      }\n    }\n    \n    // Set the invoice type and return flag\n    invoiceType.value = detectedType\n    finalize.isReturn = detectedType === 'credit_note'\n    detectionMethod.value = method\n    \n    console.log('Final decision:', {\n      detectedType,\n      isReturn: finalize.isReturn,\n      title: title,\n      method: method\n    })\n    \n    // Ensure editable model with safe defaults\n    invoice.value = {\n      invoiceNumber: msg.data?.invoiceNumber || '',\n      invoiceDate: normalizeDateToISO(msg.data?.invoiceDate || ''),\n      customerName: 'bntl',\n      items: Array.isArray(msg.data?.items) ? msg.data.items.map(it => ({\n        materialCode: it.materialCode || it.materialDescription || '',\n        materialDescription: it.materialDescription || it.materialCode || '',\n        salesQty: Math.abs(Number(it.salesQty || 0)), // Always make quantity positive\n        uom: it.uom || 'CS',\n        unitPrice: it.unitPrice,\n        lineTotal: it.lineTotal,\n        isMissing: false,\n        itemCreated: false,\n      })) : [],\n      totalAmount: Number(msg.data?.totalAmount || 0),\n      totalDiscountAmount: Number(msg.data?.totalDiscountAmount || 0),\n    }\n    // Prepare finalize items\n    finalize.items = (invoice.value.items || []).map(() => ({ leakages: 0, bursts: 0 }))\n    finalize.type = finalize.type || msg.invoiceType || 'purchase'\n    // Auto-set billed actual from extracted total\n    if (invoice.value.totalAmount && (finalize.billAmount === null || finalize.billAmount === undefined)) {\n      finalize.billAmount = invoice.value.totalAmount\n    }\n    \n    // Don't auto-validate - let user validate when ready\n  } catch (e) {\n    extractError.value = e?.message || 'Failed to extract invoice'\n  } finally {\n    extracting.value = false\n  }\n}\n\nconst toBase64 = (file) => new Promise((resolve, reject) => {\n  const reader = new FileReader()\n  reader.onload = () => {\n    const result = String(reader.result)\n    // Clear the reader to free memory\n    reader.onload = null\n    reader.onerror = null\n    resolve(result)\n  }\n  reader.onerror = (error) => {\n    reader.onload = null\n    reader.onerror = null\n    reject(error)\n  }\n  reader.readAsDataURL(file)\n})\n\nfunction normalizeDateToISO(input) {\n  if (!input) return new Date().toISOString().slice(0, 10)\n  // Already ISO yyyy-mm-dd\n  if (/^\\d{4}-\\d{2}-\\d{2}$/.test(input)) return input\n  // dd/mm/yyyy or dd-mm-yyyy or dd.mm.yyyy\n  let m = input.match(/^(\\d{1,2})[\\/.\\-](\\d{1,2})[\\/.\\-](\\d{4})$/)\n  if (m) {\n    const d = m[1].padStart(2, '0')\n    const mo = m[2].padStart(2, '0')\n    const y = m[3]\n    // If first is >12, treat as dd/mm; else assume dd/mm as well per requirement\n    return `${y}-${mo}-${d}`\n  }\n  // mm/dd/yyyy (rare). If matches and first <=12, flip.\n  m = input.match(/^(\\d{1,2})\\/(\\d{1,2})\\/(\\d{4})$/)\n  if (m) {\n    const mo = m[1].padStart(2, '0')\n    const d = m[2].padStart(2, '0')\n    const y = m[3]\n    return `${y}-${mo}-${d}`\n  }\n  // Fallback: try Date.parse\n  const t = Date.parse(input)\n  if (!isNaN(t)) return new Date(t).toISOString().slice(0, 10)\n  return new Date().toISOString().slice(0, 10)\n}\n\nconst parseMsg = (obj) => (obj && (obj.message ?? obj)) || {}\n\nconst submitInvoice = async () => {\n  if (!invoice.value || !finalize.type || isProcessing.value) return\n  \n  isProcessing.value = true\n  submitting.value = true\n  \n  try {\n    // Check memory before starting\n    if (!memoryMonitor.checkMemoryUsage()) {\n      memoryMonitor.forceCleanup()\n    }\n    \n    // Create payload with minimal memory footprint\n    const payload = {\n      invoiceNumber: invoice.value.invoiceNumber,\n      invoiceDate: invoice.value.invoiceDate,\n      customerName: 'bntl',\n      supplier: finalize.supplierName || 'bntl',\n      discount_amount: invoice.value.totalDiscountAmount || 0,\n      isReturn: finalize.isReturn,\n      items: []\n    }\n    \n    // Process items efficiently to reduce memory usage\n    const items = invoice.value.items || []\n    for (let i = 0; i < items.length; i++) {\n      const it = items[i]\n      const item = {\n        materialCode: it.materialCode,\n        materialDescription: it.materialDescription,\n        salesQty: it.salesQty,\n        uom: it.uom,\n        unitPrice: it.unitPrice,\n        lineTotal: it.lineTotal,\n      }\n      \n      // Add purchase-specific fields only if needed\n      if (finalize.type === 'purchase') {\n        item.leakages = finalize.items[i]?.leakages || 0\n        item.bursts = finalize.items[i]?.bursts || 0\n      }\n      \n      payload.items.push(item)\n    }\n    \n    // Add optional fields\n    if (finalize.type === 'purchase') {\n      if (finalize.billAmount) payload.cust_bill_actual_amount = finalize.billAmount\n      if (finalize.finalPhotoFile) {\n        // Process photo with memory optimization\n        payload.photo_base64 = await toBase64(finalize.finalPhotoFile)\n      }\n    }\n    \n    // Check memory again before API call\n    if (!memoryMonitor.checkMemoryUsage()) {\n      memoryMonitor.forceCleanup()\n    }\n    \n    // Make API call with retry logic\n    let res\n    if (finalize.type === 'purchase') {\n      res = await robustFetch('/api/method/custom_erp.custom_erp.purchase_invoice.api.create_purchase_invoice', {\n        method: 'POST', \n        headers: { 'Content-Type': 'application/json' }, \n        body: JSON.stringify({ payload })\n      })\n    } else {\n      res = await robustFetch('/api/method/custom_erp.custom_erp.sales_invoice.api.create_sales_invoice', {\n        method: 'POST', \n        headers: { 'Content-Type': 'application/json' }, \n        body: JSON.stringify({ payload })\n      })\n    }\n    \n    const raw = await safeJson(res)\n    const j = parseMsg(raw)\n    \n    if (!res.ok || !j?.success) {\n      throw new Error(j?.error || `Failed to create ${finalize.type === 'purchase' ? 'Purchase' : 'Sales'} Invoice`)\n    }\n    \n    window.alert(`${finalize.type === 'purchase' ? 'Purchase' : 'Sales'} Invoice Created: ${j?.name}`)\n    \n    // Clear memory after successful creation\n    payload.items = null\n    if (payload.photo_base64) {\n      payload.photo_base64 = null\n    }\n    \n    // Force cleanup after successful creation\n    memoryMonitor.forceCleanup()\n    \n  } catch (e) {\n    // As a safety net, verify whether the invoice actually got created\n    try {\n      const verify = await checkForDuplicateInvoice(true)\n      if (verify?.existingName) {\n        window.alert(`${finalize.type === 'purchase' ? 'Purchase' : 'Sales'} Invoice Created: ${verify.existingName}`)\n      } else {\n        throw new Error(e?.message || 'Failed')\n      }\n    } catch (vErr) {\n      window.alert(`Error: ${e?.message || 'Failed'}`)\n    }\n  } finally {\n    submitting.value = false\n    isProcessing.value = false\n    \n    // Final cleanup\n    memoryMonitor.forceCleanup()\n  }\n}\n\nconst validateItems = async () => {\n  try {\n    // Reset all item statuses first\n    invoice.value.items.forEach(item => {\n      item.isMissing = false\n      item.itemCreated = false\n    })\n    \n    // Debug: Log what we're sending\n    console.log('Sending items for validation:', invoice.value.items)\n    console.log('Items type:', typeof invoice.value.items)\n    console.log('Items length:', invoice.value.items?.length)\n    console.log('JSON stringified:', JSON.stringify(invoice.value.items))\n    console.log('Final request body:', JSON.stringify({ items: JSON.stringify(invoice.value.items) }))\n    \n    const res = await robustFetch('/api/method/custom_erp.custom_erp.purchase_invoice.api.validate_items_master', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ items: JSON.stringify(invoice.value.items) })\n    })\n    \n    // Debug: Log response\n    console.log('Validation response status:', res.status)\n    \n    const data = await safeJson(res)\n    console.log('Validation response data:', data)\n    \n    const msg = data.message || data\n    if (!res.ok || !msg.success) throw new Error(msg.error || 'Validation failed')\n    \n    // Update item statuses based on validation results\n    if (msg.validation && msg.validation.missing_items) {\n      msg.validation.missing_items.forEach(missingItem => {\n        const item = invoice.value.items.find(it => it.materialCode === missingItem.materialCode)\n        if (item) {\n          item.isMissing = true\n        }\n      })\n    }\n    \n    itemValidation.value = msg.validation\n    return msg.validation\n  } catch (e) {\n    console.error('Validation error:', e)\n    window.alert(`Validation error: ${e?.message || 'Failed to validate items'}`)\n    return { all_valid: false, missing_items: [], valid_items: [] }\n  }\n}\n\nconst showMissingItemsDialog = (missingItems) => {\n  // Mark missing items in the UI\n  invoice.value.items.forEach((item, index) => {\n    const isMissing = missingItems.some(missing => missing.materialCode === item.materialCode)\n    item.isMissing = isMissing\n  })\n  \n  const missingCodes = missingItems.map(item => item.materialCode).join(', ')\n  const ok = window.confirm(\n    `The following items are not found in master data:\\n\\n${missingCodes}\\n\\n` +\n    `Please add them as new items using the \"+\" button, or correct the item codes if there are typos.`\n  )\n}\n\nconst openNewItemDialog = (rowIndex) => {\n  const item = invoice.value.items[rowIndex]\n  newItemData.item_code = item.materialCode\n  newItemData.item_name = item.materialDescription\n  newItemData.rowIndex = rowIndex\n  newItemData.selling_price = item.unitPrice || 0\n  newItemData.valuation_price = item.unitPrice || 0\n  newItemData.uom_conversion = item.uom === 'CS' ? 6 : 1\n  showNewItemDialog.value = true\n}\n\nconst createNewItem = async () => {\n  try {\n    const res = await fetch('/api/method/custom_erp.custom_erp.purchase_invoice.api.create_new_item_for_invoice', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ item_data: JSON.stringify(newItemData) })\n    })\n    const data = await safeJson(res)\n    const msg = data.message || data\n    if (!res.ok || !msg.success) throw new Error(msg.error || 'Failed to create item')\n    \n    // Mark item as valid and remove add button\n    const rowIndex = newItemData.rowIndex\n    if (rowIndex >= 0 && rowIndex < invoice.value.items.length) {\n      invoice.value.items[rowIndex].isMissing = false\n      invoice.value.items[rowIndex].itemCreated = true\n    }\n    \n    showNewItemDialog.value = false\n    window.alert(`Item created successfully: ${msg.item_code}`)\n    \n    // Re-validate items\n    await validateItems()\n    \n  } catch (e) {\n    window.alert(`Error creating item: ${e?.message || 'Failed'}`)\n  }\n}\n\nconst handleItemCodeChange = (item, index) => {\n  // Reset item status when code changes\n  item.isMissing = false\n  item.itemCreated = false\n}\n\nconst onItemCodeChange = (item, index) => {\n  // This function can be called when item code changes to reset status\n  handleItemCodeChange(item, index)\n}\n\nconst resetItemStatuses = () => {\n  // Reset all item statuses\n  invoice.value.items.forEach(item => {\n    item.isMissing = false\n    item.itemCreated = false\n  })\n  itemValidation.value = null\n}\n\nconst checkForDuplicateInvoice = async (returnName = false) => {\n  try {\n    const apiEndpoint = finalize.type === 'purchase' \n      ? '/api/method/custom_erp.custom_erp.purchase_invoice.api.check_duplicate_invoice'\n      : '/api/method/custom_erp.custom_erp.sales_invoice.api.check_duplicate_invoice'\n    \n    const res = await robustFetch(apiEndpoint, {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({\n        supplier: finalize.supplierName,\n        customer: finalize.supplierName,\n        invoice_number: invoice.value.invoiceNumber,\n        invoice_date: invoice.value.invoiceDate,\n        invoice_type: finalize.type\n      })\n    })\n    \n    const raw = await safeJson(res)\n    const msg = parseMsg(raw)\n    \n    if (!res.ok) return { isDuplicate: false }\n    \n    return { isDuplicate: !!msg.isDuplicate, existingName: msg.existing_invoice || null }\n  } catch (e) {\n    return { isDuplicate: false }\n  }\n}\n\nconst deleteRow = (index) => {\n  if (!invoice.value?.items || index < 0 || index >= invoice.value.items.length) return\n  \n  // Store the deleted row data for undo\n  const deletedRow = {\n    index: index,\n    item: { ...invoice.value.items[index] },\n    finalizeItem: { ...finalize.items[index] }\n  }\n  \n  // Remove from invoice items\n  invoice.value.items.splice(index, 1)\n  \n  // Remove from finalize items\n  finalize.items.splice(index, 1)\n  \n  // Add to deleted rows stack\n  deletedRows.value.push(deletedRow)\n}\n\nconst undoLastDelete = () => {\n  if (deletedRows.value.length === 0) return\n  \n  // Get the last deleted row\n  const lastDeleted = deletedRows.value.pop()\n  \n  // Insert back at the original position\n  invoice.value.items.splice(lastDeleted.index, 0, lastDeleted.item)\n  finalize.items.splice(lastDeleted.index, 0, lastDeleted.finalizeItem)\n}\n\n// Last invoices functions\nconst showLastInvoices = async () => {\n  if (!finalize.type) {\n    window.alert('Please select an invoice type first')\n    return\n  }\n  \n  showLastInvoicesDialog.value = true\n  await fetchLastInvoices()\n}\n\nconst fetchLastInvoices = async () => {\n  loadingLastInvoices.value = true\n  lastInvoices.value = []\n  \n  try {\n    const apiEndpoint = finalize.type === 'purchase' \n      ? '/api/method/custom_erp.custom_erp.purchase_invoice.api.get_last_invoices'\n      : '/api/method/custom_erp.custom_erp.sales_invoice.api.get_last_invoices'\n    \n    const res = await robustFetch(apiEndpoint, {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ limit: 3 })\n    })\n    \n    const data = await safeJson(res)\n    const msg = data.message || data\n    \n    if (!res.ok || !msg?.success) {\n      throw new Error(msg?.error || 'Failed to fetch invoices')\n    }\n    \n    lastInvoices.value = msg.invoices || []\n  } catch (e) {\n    console.error('Error fetching last invoices:', e)\n    window.alert(`Error fetching invoices: ${e?.message || 'Failed to fetch invoices'}`)\n  } finally {\n    loadingLastInvoices.value = false\n  }\n}\n\nconst formatDate = (dateString) => {\n  if (!dateString) return 'N/A'\n  try {\n    const date = new Date(dateString)\n    return date.toLocaleDateString('en-IN', {\n      year: 'numeric',\n      month: 'short',\n      day: 'numeric'\n    })\n  } catch (e) {\n    return dateString\n  }\n}\n\nconst formatAmount = (amount) => {\n  if (!amount && amount !== 0) return '0.00'\n  return Number(amount).toLocaleString('en-IN', {\n    minimumFractionDigits: 2,\n    maximumFractionDigits: 2\n  })\n}\n\nconst getStatusClass = (docstatus) => {\n  switch (docstatus) {\n    case 0:\n      return 'bg-yellow-100 text-yellow-800'\n    case 1:\n      return 'bg-green-100 text-green-800'\n    case 2:\n      return 'bg-red-100 text-red-800'\n    default:\n      return 'bg-gray-100 text-gray-800'\n  }\n}\n\nconst getStatusText = (docstatus) => {\n  switch (docstatus) {\n    case 0:\n      return 'Draft'\n    case 1:\n      return 'Submitted'\n    case 2:\n      return 'Cancelled'\n    default:\n      return 'Unknown'\n  }\n}\n\n// Watch for changes in scanned image to ensure proper preview\nwatch([scannedImageBlob, scannedImageUrl], () => {\n  console.log('Scanned image changed:', {\n    scannedImageBlob: !!scannedImageBlob.value,\n    scannedImageUrl: !!scannedImageUrl.value,\n    imagePreviewUrl: imagePreviewUrl.value,\n    canExtract: canExtract.value\n  })\n})\n\nonMounted(() => {\n  // ensure auth state already guarded by router; nothing additional for now\n})\n\nconst confirmAndSubmit = async () => {\n  if (!invoice.value || isProcessing.value) return\n\n  // Validate items first\n  const validationResult = await validateItems()\n  if (!validationResult?.all_valid) {\n    showMissingItemsDialog(validationResult?.missing_items || [])\n    return\n  }\n\n  // Duplicate warning\n  const dup = await checkForDuplicateInvoice(true)\n  if (dup?.isDuplicate) {\n    const proceedDup = window.confirm(\n      `A ${finalize.type} invoice already exists with the same details.\\n\\n` +\n      `Supplier: ${finalize.supplierName}\\n` +\n      `Invoice No: ${invoice.value.invoiceNumber}\\n` +\n      `Date: ${invoice.value.invoiceDate}\\n` +\n      `${dup.existingName ? `Existing: ${dup.existingName}\\n` : ''}` +\n      `Do you want to create it anyway?`\n    )\n    if (!proceedDup) return\n  }\n\n  const lines = [\n    `Type: ${finalize.type}`,\n    `Purchase Invoice Type: ${finalize.isReturn ? 'Credit Note (Return)' : 'Tax Invoice (Regular)'}`,\n    `Invoice No: ${invoice.value.invoiceNumber}`,\n    `Date: ${invoice.value.invoiceDate}`,\n    `Party: ${invoice.value.customerName}`,\n    `Items: ${invoice.value.items.length}`,\n    `Billed Actual Total: ${finalize.billAmount ?? ''}`,\n  ]\n  const ok = window.confirm(`Confirm create ${finalize.type} invoice?\\n\\n` + lines.join('\\n'))\n  if (!ok) return\n\n  await submitInvoice()\n}\n</script>\n\n<style scoped>\n/* Ensure table is responsive and scrollable */\n.overflow-x-auto {\n  scrollbar-width: thin;\n  scrollbar-color: #cbd5e0 #f7fafc;\n}\n\n.overflow-x-auto::-webkit-scrollbar {\n  height: 8px;\n}\n\n.overflow-x-auto::-webkit-scrollbar-track {\n  background: #f7fafc;\n  border-radius: 4px;\n}\n\n.overflow-x-auto::-webkit-scrollbar-thumb {\n  background: #cbd5e0;\n  border-radius: 4px;\n}\n\n.overflow-x-auto::-webkit-scrollbar-thumb:hover {\n  background: #a0aec0;\n}\n\n/* Ensure inputs don't overflow on small screens */\n@media (max-width: 640px) {\n  .w-16 {\n    width: 4rem;\n  }\n  \n  .w-20 {\n    width: 5rem;\n  }\n  \n  .w-32 {\n    width: 8rem;\n  }\n  \n  .w-48 {\n    width: 12rem;\n  }\n  \n  .w-80 {\n    width: 20rem;\n  }\n}\n\n/* Visual indicators for item status */\n.bg-red-50 {\n  background-color: #fef2f2;\n}\n\n.bg-green-50 {\n  background-color: #f0fdf4;\n}\n\n.border-red-500 {\n  border-color: #ef4444;\n}\n\n.border-green-500 {\n  border-color: #22c55e;\n}\n\n/* Add button styling */\n.add-button {\n  transition: all 0.2s ease-in-out;\n}\n\n.add-button:hover {\n  transform: scale(1.1);\n}\n\n/* Dialog animations */\n.fixed {\n  animation: fadeIn 0.2s ease-out;\n}\n\n@keyframes fadeIn {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n\n/* Drag and drop styling */\n.border-dashed {\n  transition: all 0.2s ease-in-out;\n}\n\n.border-dashed:hover {\n  border-color: #3b82f6;\n  background-color: #eff6ff;\n}\n\n.border-dashed.border-blue-400 {\n  border-color: #3b82f6;\n  background-color: #eff6ff;\n}\n\n/* Scanner button styling */\n.scanner-button {\n  transition: all 0.2s ease-in-out;\n}\n\n.scanner-button:hover:not(:disabled) {\n  transform: translateY(-1px);\n  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);\n}\n\n.scanner-button:disabled {\n  cursor: not-allowed;\n  opacity: 0.6;\n}\n\n/* Image preview styling */\n.image-preview {\n  transition: all 0.3s ease-in-out;\n}\n\n.image-preview:hover {\n  transform: scale(1.02);\n}\n\n/* Invoice type indication styling */\n.invoice-type-indication {\n  transition: all 0.2s ease-in-out;\n}\n\n.invoice-type-indication:hover {\n  transform: translateY(-1px);\n  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n}\n\n/* Checkbox styling */\ninput[type=\"checkbox\"] {\n  transition: all 0.2s ease-in-out;\n}\n\ninput[type=\"checkbox\"]:checked {\n  background-color: #3b82f6;\n  border-color: #3b82f6;\n}\n\ninput[type=\"checkbox\"]:focus {\n  outline: none;\n  ring: 2px;\n  ring-color: #3b82f6;\n  ring-offset: 2px;\n}\n\n/* Processing state styling */\n.processing-state {\n  pointer-events: none;\n  opacity: 0.7;\n}\n\n.processing-state button {\n  cursor: not-allowed;\n}\n</style>\n\n\n"],"names":["selectedFile","ref","selectedFileName","capturedDataUrl","extractError","extracting","invoice","submitting","scannerConfig","reactive","isDragOver","isFinalPhotoDragOver","scanning","scannedImageBlob","scannedImageUrl","imagePreviewUrl","computed","finalPhotoPreviewUrl","finalize","deletedRows","itemValidation","showNewItemDialog","newItemData","invoiceType","isProcessing","detectionMethod","showLastInvoicesDialog","loadingLastInvoices","lastInvoices","onFileSelected","e","f","_b","_a","onFinalPhotoSelected","onDrop","imageFile","file","onDragLeave","onFinalPhotoDrop","onFinalPhotoDragLeave","scan","__async","res","error","data","format","byteArray","c","imageBlob","canExtract","err","scanFinalPhoto","clearImage","clearFinalPhoto","safeJson","text","_","cleaned","memoryMonitor","memory","usedMB","totalMB","limitMB","robustFetch","_0","_1","url","opts","retryDelays","attempt","controller","timeout","__spreadProps","__spreadValues","r","extractInvoice","b64","toBase64","msg","title","detectedType","method","_c","item","_d","normalizeDateToISO","_e","_f","it","_g","_h","resolve","reject","reader","result","input","m","d","mo","t","parseMsg","obj","submitInvoice","payload","items","i","raw","j","verify","checkForDuplicateInvoice","vErr","validateItems","missingItem","showMissingItemsDialog","missingItems","index","isMissing","missing","missingCodes","openNewItemDialog","rowIndex","createNewItem","resetItemStatuses","returnName","apiEndpoint","deleteRow","deletedRow","undoLastDelete","lastDeleted","showLastInvoices","fetchLastInvoices","formatDate","dateString","formatAmount","amount","getStatusClass","docstatus","getStatusText","watch","onMounted","confirmAndSubmit","validationResult","dup","lines","_createElementVNode","_hoisted_1","_hoisted_2","_hoisted_3","_hoisted_4","_cache","_hoisted_5","_toDisplayString","_unref","session","_createVNode","_component_Button","$event","_hoisted_6","_hoisted_7","_hoisted_8","_hoisted_9","_hoisted_10","_vModelRadio","_hoisted_11","_hoisted_12","_vModelText","_normalizeClass","_openBlock","_createElementBlock","_hoisted_13","_hoisted_15","_hoisted_16","_hoisted_17","_hoisted_21","_createTextVNode","_createBlock","_component_Alert","_hoisted_22","_hoisted_23","_hoisted_24","_hoisted_25","_hoisted_26","_hoisted_27","_hoisted_28","_hoisted_29","_hoisted_30","_vModelCheckbox","_hoisted_31","_hoisted_32","_hoisted_33","_hoisted_34","_hoisted_36","_hoisted_37","_hoisted_38","_hoisted_42","_hoisted_43","_hoisted_44","_hoisted_45","_hoisted_46","_hoisted_47","_hoisted_48","_hoisted_49","_hoisted_50","_hoisted_51","_hoisted_52","_hoisted_53","_hoisted_54","_hoisted_55","_hoisted_56","_hoisted_57","_Fragment","idx","_hoisted_58","_hoisted_59","_hoisted_61","_hoisted_62","_hoisted_63","_hoisted_65","_hoisted_67","_vModelSelect","_hoisted_69","_hoisted_71","_hoisted_73","_hoisted_74","_hoisted_75","_hoisted_76","_hoisted_77","_hoisted_78","_hoisted_79","_hoisted_80","_hoisted_81","_hoisted_82","_hoisted_83","_hoisted_84","_hoisted_85","_hoisted_86","_hoisted_87","_renderList","_hoisted_88","_hoisted_89","_hoisted_90","_hoisted_91","_hoisted_92","_hoisted_93","_hoisted_94"],"mappings":"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"}